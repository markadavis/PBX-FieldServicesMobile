/*
 * ! SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/m/library","sap/m/List","sap/m/Popover","sap/m/StandardListItem",'sap/m/MultiInput','sap/m/MultiComboBox','sap/m/Token','sap/m/Tokenizer','sap/ui/comp/smartfield/SmartField','sap/ui/comp/odata/MetadataAnalyser',"sap/ui/model/ParseException","sap/ui/model/ValidateException",'sap/ui/model/BindingMode','sap/ui/comp/odata/ODataType','sap/ui/comp/providers/ValueHelpProvider',"sap/ui/comp/util/FormatUtil","sap/ui/core/format/DateFormat","sap/ui/comp/smartfilterbar/FilterProvider","sap/base/Log","sap/base/util/deepEqual","sap/ui/comp/library","sap/ui/core/library","sap/ui/core/ResizeHandler","sap/m/Link","sap/m/Text","sap/m/FlexBox","sap/m/HBox","sap/base/util/isEmptyObject","sap/base/security/sanitizeHTML"],function(M,L,P,S,a,b,T,c,d,e,f,V,B,O,g,F,D,h,j,k,l,m,R,n,o,p,H,q,s){"use strict";var r=l.valuehelpdialog.ValueHelpRangeOperation;var t=l.smartfilterbar.DisplayBehaviour;var u=l.smartfield.TextInEditModeSource;var v=m.ValueState;var w=M.PlacementType;var I="-mInput";var x="-mInputTokenizer";var y="-mInputHBox";var z="-mMoreLink";var A=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");var C=d.extend("sap.ui.comp.smartmultiinput.SmartMultiInput",{metadata:{library:"sap.ui.comp",properties:{supportRanges:{type:"boolean",defaultValue:false},supportMultiSelect:{type:"boolean",defaultValue:true},enableODataSelect:{type:"boolean",defaultValue:false},requestAtLeastFields:{type:"string",defaultValue:""},textSeparator:{type:"string",defaultValue:null}},events:{beforeCreate:{allowPreventDefault:true,parameters:{oData:{type:"object"},mParameters:{type:"object"}}},beforeRemove:{allowPreventDefault:true,parameters:{mParameters:{type:"object"}}},tokenUpdate:{parameters:{type:{type:"string"},addedTokens:{type:"sap.m.Token[]"},removedTokens:{type:"sap.m.Token[]"}}},selectionChange:{parameters:{changedItem:{type:"sap.ui.core.Item"},selected:{type:"boolean"}}}}},renderer:function(i,G){d.getMetadata().getRenderer().render(i,G);if(G._oEmptyDash){var J=G.getTokens().length>0?false:true;G._oEmptyDash.setVisible(J);if(J&&G._oMoreLink){G._oMoreLink.setVisible(false);}}}});C.prototype.getTokens=function(){if(this._isReadMode()&&this._oTokenizer){return this._oTokenizer.getTokens();}else if(this._oMultiComboBox&&this._oMultiComboBox.getAggregation("tokenizer")){return this._oMultiComboBox.getAggregation("tokenizer").getTokens();}else if(this._oMultiInput){return this._oMultiInput.getTokens();}return[];};C.prototype.getValue=function(){return this.getTokens();};C.prototype._createMultiInput=function(){var i=this._createAttributes();if(this._oMultiComboBox){this._oMultiComboBox.destroy();this._oMultiComboBox=null;}this._oMultiInput=new a(this.getId()+I,i);this._oMultiInput.attachChange(function(J){this._validateValueOnChange(J.getParameter("value"));},this);if(this.getBindingContext()){this._bindMultiInput();}this._oMultiInput.attachTokenUpdate(function(J){this._validateValueOnChange(this._oMultiInput.getValue());var K=J.getParameters();delete K.id;this.fireTokenUpdate(K);},this);var G={control:this._oMultiInput,onCreate:"_onMultiInputCreate",params:{type:{type:this._getType(),property:this._oFactory._oMetaData.property}}};this._initMultiInputValueHelp(G);return G;};C.prototype._createMultiComboBox=function(){var i=this._createAttributes();this._oMultiComboBox=new b(this.getId()+"mComboBox",i);if(this.getBindingContext()){this._bindMultiComboBox();}else{this._oMultiInput=this._oMultiComboBox._oTokenizer;}this._oMultiComboBox.attachSelectionChange(function(J){var K=J.getParameters();delete K.id;this.fireSelectionChange(K);},this);var G={control:this._oMultiComboBox,onCreate:"_onCreate",params:{type:{type:this._getType(),property:this._oFactory._oMetaData.property},valuehelp:{annotation:this._getValueListAnnotation(),aggregation:"items",noDialog:true,noTypeAhead:true}}};return G;};C.prototype._createAttributes=function(){var N={width:true,textAlign:true,placeholder:true,tooltip:true,name:true,valueState:true,valueStateText:true};var i=this._oFactory.createAttributes(null,this._oFactory._oMetaData.property,N,{event:"change",parameter:"value"});return i;};function E(G){var J=G.getParameter("tokens"),K,N,i=0,Q=[],U=null,W;this._onCancel();if(this.oControl instanceof sap.m.MultiInput){this.oControl.setValue("");var X=this.oControl.getTokens();var Y=[];var Z=[];var $=[];X.forEach(function(a1){var b1=J.some(function(d1){return a1.getKey()===d1.getKey();});if(!b1){Z.push(a1);}else{var c1=J.filter(function(d1){return a1.getKey()===d1.getKey();})[0];$.push(c1);}});J.forEach(function(a1){var b1=X.some(function(c1){return c1.getKey()===a1.getKey();});if(!b1){Y.push(a1);$.push(a1);}});this.oControl.setTokens($);this.oControl.fireTokenUpdate({type:"tokensChanged",removedTokens:Z,addedTokens:Y});i=J.length;while(i--){U=J[i].data("row");if(U){Q.push(U);}}}else{if(J[0]){if(this.bIsSingleIntervalRange){K=J[0].data("range");if(K){if(this._sType==="datetime"){W=D.getDateTimeInstance(Object.assign({},this._oDateFormatSettings,{UTC:false}));if(typeof K.value1==="string"){K.value1=new Date(K.value1);}if(K.operation==="BT"){if(typeof K.value2==="string"){K.value2=new Date(K.value2);}N=W.format(K.value1)+"-"+W.format(K.value2);}else{N=W.format(K.value1);}}else{if(K.operation==="BT"){N=K.value1+"-"+K.value2;}else{N=K.value1;}}}}else{N=J[0].getKey();}U=J[0].data("row");if(U){Q.push(U);}}this.oControl.setValue(N);this.oControl.fireChange({value:N,validated:true});}this._calculateAndSetFilterOutputData(Q);}C.prototype._initMultiInputValueHelp=function(i){var G=this._getFilterType(this._oFactory._oMetaData.property.property),J={},K=this._getDateFormatSettings(),N;this._oFactory._getValueHelpDialogTitle(J);if(this._getValueListAnnotation()){i.params.valuehelp={annotation:this._getValueListAnnotation(),aggregation:"suggestionRows",noDialog:false,noTypeAhead:false,supportMultiSelect:this.getSupportMultiSelect(),supportRanges:this.getBindingContext()?false:this.getSupportRanges(),type:G,displayBehaviour:this._getDisplayBehaviour()};}else if(this.getSupportRanges()&&!this.getBindingContext()){N=new g({fieldName:this._getPropertyName(),preventInitialDataFetchInValueHelpDialog:true,model:this.getModel(),control:this._oMultiInput,title:J.dialogtitle,supportMultiSelect:this.getSupportMultiSelect(),supportRanges:true,type:G,dateFormatSettings:K,isUnrestrictedFilter:this._isTimeType(G),displayBehaviour:this._getDisplayBehaviour()});N._onOK=E;this._oMultiInput.addValidator(this._validateToken.bind(this));}else{this._oMultiInput.setShowValueHelp(false);this._oMultiInput.addValidator(this._validateToken.bind(this));}};C.prototype._bindMultiInput=function(){var i=this.getBinding("value").getBindingMode();switch(i){case B.OneTime:this._bindMultiInputOneTime();break;case B.OneWay:this._bindMultiInputOneWay();break;case B.TwoWay:default:this._bindMultiInputTwoWay();}};C.prototype._bindMultiInputOneTime=function(){var i=this;this._readNavigationPropertySet().then(function(G){G.results.forEach(function(J){var K=J[i._getPropertyName()];var N=i._getDescriptionFieldName();var Q=N?J[N]:"";i._oMultiInput.addToken(i._createToken(K,Q));});});};C.prototype._bindMultiInputOneWay=function(){this._bindMultiInputTokens(this._oMultiInput);};C.prototype._bindMultiInputTwoWay=function(){this._bindMultiInputTokens(this._oMultiInput);this._oMultiInput.attachTokenUpdate(function(i){i.getParameter("addedTokens").forEach(this._addToken.bind(this));i.getParameter("removedTokens").forEach(this._removeToken.bind(this));},this);};C.prototype._bindMultiInputTokens=function(i){var N=this._getNavigationPath(),G=this._getSelectExpandParameter();if(!q(G)){i.bindAggregation("tokens",{path:N,parameters:G,factory:this._tokensFactory.bind(this)});}else{i.bindAggregation("tokens",{path:N,factory:this._tokensFactory.bind(this)});}};C.prototype._getSelectExpandParameter=function(){var i={};if(this.getEnableODataSelect()){i.select=this._addODataSelectParameters();}if(this._oFactory._oMetaData.annotations.text&&this._oFactory._oMetaData.annotations.text.navigationPathHelp){i.expand=this._oFactory._oMetaData.annotations.text.navigationPathHelp;}return i;};C.prototype._addODataSelectParameters=function(i){var G=this._getPropertyName();if(this._getDescriptionFieldName()){G=G+","+this._getDescriptionFieldName();}if(this.getRequestAtLeastFields()){G=G+","+this.getRequestAtLeastFields();}return G;};C.prototype._bindMultiComboBox=function(){var i=this.getBinding("value").getBindingMode();switch(i){case B.OneTime:this._bindMultiComboBoxOneTime();break;case B.OneWay:this._bindMultiComboBoxOneWay();break;case B.TwoWay:default:this._bindMultiComboBoxTwoWay();}};C.prototype._bindMultiComboBoxOneTime=function(){var i=this;this._readNavigationPropertySet().then(function(G){var K=G.results.map(function(J){return J[i._getPropertyName()];});i._oMultiComboBox.setSelectedKeys(K);});};C.prototype._bindMultiComboBoxOneWay=function(){this._createAndAttachHelperMultiInput();};C.prototype._bindMultiComboBoxTwoWay=function(){this._createAndAttachHelperMultiInput();this._oMultiComboBox.attachSelectionChange(function(i){var G=i.getParameter("selected"),J=i.getParameter("changedItem"),K={},N,Q,U;if(G){K[this._getPropertyName()]=J.getKey();U=J.getBindingContext("list")||J.getBindingContext();N=U.getProperty();this._getEntityType().key.propertyRef.forEach(function(W){if(N&&N[W.name]){K[W.name]=N[W.name];}});}else{Q=this._oMultiInput.getTokens().filter(function(W){return W.getKey()===J.getKey();})[0];}if(G){this._createEntity(K);}else{this._removeEntity(Q.getBindingContext());}},this);};C.prototype._readNavigationPropertySet=function(){var i=this;return new Promise(function(G,J){var K=i.getBindingContext(),N=i._getModel(),Q=i._getNavigationPath();N.read(Q,{context:K,success:function(U){G(U);},error:function(U){i.setValueState(v.Error);i.setValueStateText(U.responseText);J(U);}});});};C.prototype._createAndAttachHelperMultiInput=function(){this._oMultiInput=new a();this._oMultiInput.setBindingContext(this.getBindingContext());this._oMultiInput.setModel(this._getModel());this._bindMultiInputTokens(this._oMultiInput);var i=this._oMultiInput.getBinding("tokens");function G(){var K=this._oMultiInput.getTokens().map(function(J){return J.getKey();});if(this._oMultiComboBox){this._oMultiComboBox.setSelectedKeys(K);}}G.call(this);i.attachChange(G,this);};C.prototype._getReadTokenList=function(){if(!this.oReadTokenList){this.oReadTokenList=new L();this.addDependent(this.oReadTokenList);}return this.oReadTokenList;};C.prototype._getReadTokenListPopover=function(){if(!this.oReadTokenListPopover){this.oReadTokenListPopover=new P({showArrow:true,placement:w.Auto,showHeader:false,contentMinWidth:"auto",content:[this.oReadTokenList]});this.addDependent(this.oReadTokenListPopover);}return this.oReadTokenListPopover;};C.prototype._handleNMoreIndicatorPress=function(){var G=this.getTokens();if(!G){return;}var J=this._getReadTokenList();var K=this._getReadTokenListPopover();J.removeAllItems();for(var i=0,N=G.length;i<N;i++){var Q=G[i],U=new S({title:Q.getText()});J.addItem(U);}if(this._oMoreLink.getDomRef()){K.openBy(this._oMoreLink.getDomRef());}};C.prototype._onResize=function(){if(this._isReadMode()&&this._oTokenizer){this._deregisterResizeHandler();this._oTokenizer.setMaxWidth(this.$().width()+"px");this._oTokenizer.setRenderMode("Narrow");this._oTokenizer.scrollToEnd();this._registerResizeHandler();}};C.prototype.onBeforeRendering=function(){if(d.prototype.onBeforeRendering){d.prototype.onBeforeRendering.apply(this,arguments);}this._deregisterResizeHandler();};C.prototype.onAfterRendering=function(){if(d.prototype.onAfterRendering){d.prototype.onAfterRendering.apply(this,arguments);}if(this.getMode()==="display"&&this.bControlNotRendered){this._oHBox.removeAllItems();this._oMoreLink.setVisible(false);this.getTokens().forEach(function(i){var G=this._generateDisplayText(i.getText());this._oHBox.addItem(G);},this);}this._registerResizeHandler();};C.prototype._registerResizeHandler=function(){if(!this._iResizeHandlerId){this._iResizeHandlerId=R.register(this,this._onResize.bind(this));}};C.prototype._deregisterResizeHandler=function(){if(this._iResizeHandlerId){R.deregister(this._iResizeHandlerId);this._iResizeHandlerId=null;}};C.prototype._createTokenizer=function(){this._oTokenizer=new c(this.getId()+x,{editable:false,visible:false,width:"100%"});this._oHBox=new H(this.getId()+y);this._oMoreLink=new n(this.getId()+z,{press:this._handleNMoreIndicatorPress.bind(this)});this._oEmptyDash=new o({text:"–",visible:true});var N=this._getNavigationPath(),i=this._getSelectExpandParameter();if(this.getBindingContext()){this._bindMultiInputTokens(this._oTokenizer);this._oHBox.bindAggregation("items",{path:N,parameters:i,factory:this._textFactory.bind(this)});}else{this.attachInnerControlsCreated(this._mirrorTokensToDisplayTokenizer,this);}var G=new p({height:"100%",items:[this._oEmptyDash,this._oHBox,this._oMoreLink,this._oTokenizer]});return{control:G,onCreate:"_onCreate"};};C.prototype._textFactory=function(i,G){var J=G.getProperty(this._getPropertyName()),K=J instanceof Date?this._formatValue(J):J.toString(),N=this._getDescriptionFieldName(),Q=N?G.getProperty(N):"",U=this._getFormattedText(K,Q),W;if(this.getDomRef()){this.bControlNotRendered=false;W=this._generateDisplayText(U);}else{this.bControlNotRendered=true;W=new o({text:U});}if(this._oEmptyDash){this._oEmptyDash.setVisible(false);}return W;};C.prototype._generateDisplayText=function(i){var G=this.getDomRef(),J=G.offsetWidth,N=X("999 "+A.getText("POPOVER_DEFINE_MORE_LINKS")),K=new o({wrapping:false}),Q,U,W;i=s(i);function X(i){var $=document.createElement("span");$.style.whiteSpace="nowrap";$.innerHTML=i;$.className="sapMText";G.appendChild($);var a1=G.childNodes;var b1=a1[a1.length-1].offsetWidth;G.removeChild(G.childNodes[a1.length-1]);return b1;}if(this._oHBox.getItems().length===0){this._iHBoxWidth=0;this._iHiddenLabelsCount=0;}this._oHBox.getItems().filter(function($){return!$.getVisible();}).forEach(function($){this._oHBox.removeItem($);}.bind(this));K.setTooltip(i);i=this._iHBoxWidth===0?i:"\u00a0"+this.getTextSeparator()+"\u00a0"+i;K.setText(i);var Y=X(i);this._iHBoxWidth+=Y;if(this._iHiddenLabelsCount===0&&this._iHBoxWidth<=J){this._oMoreLink.setVisible(false);}else{while(this._iHBoxWidth&&this._iHBoxWidth>J-N){this._iHiddenLabelsCount+=1;if(this._oHBox.getItems()[0]){var Z=X(this._oHBox.getItems()[0].getText());this._iHBoxWidth-=Z;this._oHBox.removeItem(0);}else{this._iHBoxWidth-=Y;K.setVisible(false);}}if(this._oHBox.getItems().length===0&&this._iHiddenLabelsCount===1&&!K.getVisible()){this._iHiddenLabelsCount=0;this._iHBoxWidth+=Y;K.setVisible(true);K.setWrapping(true);this._oMoreLink.setVisible(false);}else{if(this._oHBox.getItems().length>0){Q=this._oHBox.getItems()[0];Q.setText(Q.getTooltip());if(this._oHBox.getItems().length-1>0){U=this._oHBox.getItems()[(this._oHBox.getItems().length-1)];W="\u00a0"+this.getTextSeparator()+"\u00a0"+U.getTooltip();U.setText(W);}K.setText(K.getText()+"\u00a0"+this.getTextSeparator()+"\u00a0");}else{K.setText(K.getTooltip()+"\u00a0"+this.getTextSeparator()+"\u00a0");}this._oMoreLink.setVisible(true);this._oMoreLink.setText(this._iHiddenLabelsCount+" "+A.getText("POPOVER_DEFINE_MORE_LINKS"));}}return K;};C.prototype._mirrorTokensToDisplayTokenizer=function(){if(this.getMode()==="display"&&typeof this._oMultiInput!=="undefined"){this._oTokenizer.removeAllTokens();this._oHBox.removeAllItems();this._oMoreLink.setVisible(false);this._oMultiInput.getTokens().forEach(function(i){var N=new T({text:i.getText(),key:i.getKey()});this._oTokenizer.addToken(N);var G=this._generateDisplayText(i.getText());this._oHBox.addItem(G);},this);}};C.prototype.getTextSeparator=function(){var i=this.getProperty("textSeparator");if(i){return i;}return A.getText("SMARTMULTIINPUT_SEPARATOR");};C.prototype._tokensFactory=function(i,G){var J;if(this._oFactory){var K=G.getProperty(this._getPropertyName());var N=K instanceof Date?this._formatValue(K):K.toString();var Q=this._getDescriptionFieldName();var U=Q?G.getProperty(Q):"";J=this._createToken(N,U,G);}else{J=new T();}return J;};C.prototype._createToken=function(K,i,G){var J=this._getFormattedText(K,i);var N;N=new T();N.setKey(K);N.setText(J);return N;};C.prototype._addToken=function(i){var G={},J,K=i.data("row"),N=i.data("range");G[this._getPropertyName()]=i.getKey();if(K){this._getEntityType().key.propertyRef.forEach(function(Q){if(K[Q.name]){G[Q.name]=K[Q.name];}});}if(N){G["range"]=N;}this.setValueState(v.None);J=this._createEntity(G);i.setBindingContext(J);};C.prototype._createEntity=function(i){var G=this._getModel(),J=this._getEntitySetName(),K=G._resolveGroup(J),N=this._getNavigationPath(),Q=this.fireBeforeCreate({oData:i,mParameters:K});K.refreshAfterChange=true;K.context=this.getBindingContext();if(Q){K.properties=i;var U=G.createEntry(N,K);return U;}};C.prototype._removeToken=function(i){this._removeEntity(i.getBindingContext());i.destroy();};C.prototype._removeEntity=function(i){var G=this._getModel(),J=this._getEntitySetName(),K=G._resolveGroup(J),N=this.fireBeforeRemove({mParameters:K});var Q=G.getDeferredGroups().indexOf(K.groupId)>=0||G.getDeferredBatchGroups().indexOf(K.groupId)>=0;if(Q&&this._entityHasPendingCreateChange(G,i)){G.deleteCreatedEntry(i);N=false;}K.refreshAfterChange=true;K.context=i;if(N){var U="";G.remove(U,K);}};C.prototype._entityHasPendingCreateChange=function(i,G){var J=i.getPendingChanges();var K=i.getKey(G);return!!J[K]&&k(J[K],G.getObject());};C.prototype._getEntityKeyProperties=function(i){var G=this._getModel(),J=G.oMetadata._getEntityTypeByPath(i.getPath()),K={};J.key.propertyRef.forEach(function(N){var Q=N.name;K[Q]=i.getProperty(Q);});return K;};C.prototype.checkClientError=function(){if(this.getMode()==="display"){return false;}return!this._validateMultiInput();};C.prototype.getRangeData=function(){var i=this.getTokens(),G=[];i.forEach(function(J){var K;if(J.data("range")){K=J.data("range");}else{K=this._getDefaultTokenRangeData(J);}G.push(K);},this);return G;};C.prototype.setRangeData=function(i){if(!this.getBindingContext()){var G=Array.isArray(i)?i:[i];if(!this._oMultiInput){var J=this.getEditable(),K=this.getEnabled(),N=this.getContextEditable();this.setEditable(true);this.setEnabled(true);this.setContextEditable(true);this.setEditable(J);this.setEnabled(K);this.setContextEditable(N);}this._oMultiInput.removeAllTokens();G.forEach(function(Q){var U=this._getTokenTextFromRangeData(Q);var W=new T({text:U,key:U});W.data("range",Q);this._oMultiInput.addToken(W);},this);this._mirrorTokensToDisplayTokenizer();}else{j.warning("setRangeData can only be used without property binding");}};C.prototype._getTokenTextFromRangeData=function(i){var G="";switch(i.operation){case r.EQ:G="="+i.value1;break;case r.GT:G=">"+i.value1;break;case r.GE:G=">="+i.value1;break;case r.LT:G="<"+i.value1;break;case r.LE:G="<="+i.value1;break;case r.Contains:G="*"+i.value1+"*";break;case r.StartsWith:G=i.value1+"*";break;case r.EndsWith:G="*"+i.value1;break;case r.BT:G=i.value1+"...";if(i.value2){G+=i.value2;}break;default:G="";}if(i.exclude&&G!==""){G="!("+G+")";}return G;};C.prototype._getComputedTextInEditModeSource=function(){var i=this.getTextInEditModeSource();if(this.isPropertyInitial("textInEditModeSource")&&this.getMode()==="edit"){i=u.None;}return i;};C.prototype.getFilter=function(){var i=[this._getPropertyName()],G={},J=this.getRangeData(),K;G[this._getPropertyName()]={ranges:J,items:[]};K=h.generateFilters(i,G);return K&&K.length===1&&K[0];};C.prototype._getDefaultTokenRangeData=function(i){var G={exclude:false,operation:r.EQ,value1:this._parseValue(i.getKey()),value2:"",keyField:this._getPropertyName()};return G;};C.prototype._validateToken=function(i){var G=i.text;var J=this._validateValue(G);if(J){var K=new T({key:G,text:G});if(this.getSupportRanges()){var N=this._getDefaultTokenRangeData(K);K.data("range",N);K.setText("="+G);}return K;}};C.prototype._validateMultiInput=function(){if(this._oMultiInput.getValueState()!==v.None){return false;}if(this.getRequired()&&this.getTokens().length===0){this.setValueStateText(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("VALUEHELPVALDLG_FIELDMESSAGE"));this.setValueState(v.Error);return false;}else{this.setValueState(v.None);return true;}};C.prototype._validateValueOnChange=function(i){if(i===""){this.setValueState(v.None);this._validateMultiInput();}else{this._validateValue(i);}};C.prototype._parseValue=function(i){return this._getType().parseValue(i,"string");};C.prototype._formatValue=function(i){return this._getType().formatValue(i,"string");};C.prototype._validateValue=function(i){try{var G=this._parseValue(i);this._getType().validateValue(G);this.setValueState(v.None);return true;}catch(J){this.setValueState(v.Error);this.setValueStateText(J.message);var K={element:this._oMultiInput,property:"value",type:this._getType(),newValue:i,oldValue:null,exception:J,message:J.message};if(J instanceof f){this.fireParseError(K);}else if(J instanceof V){this.fireValidationError(K);}return false;}};C.prototype._getModel=function(){if(this._oFactory){return this._oFactory._oModel;}};C.prototype._getDateFormatSettings=function(){var i=this.data("dateFormatSettings");if(typeof i==="string"){try{i=JSON.parse(i);}catch(G){}}return i;};C.prototype._getNavigationPath=function(){return this._oFactory._oMetaData.navigationPath;};C.prototype._getDescriptionFieldName=function(){var i=this._oFactory._oMetaData.annotations.text;if(i){if(i.navigationPathHelp){return i.navigationPathHelp+"/"+i.property.property.name;}return i.property.property.name;}};C.prototype._getType=function(){if(!this._oType){var i;if(this._isEdmTimeType()){i=this._getDateFormatSettings();}this._oType=this._oFactory._oTypes.getType(this._oFactory._oMetaData.property,i);}return this._oType;};C.prototype._isEdmTimeType=function(){var i=["Edm.DateTime","Edm.DateTimeOffset","Edm.Time"];return i.indexOf(this._oFactory._oMetaData.property.property.type)>-1;};C.prototype._isTimeType=function(i){var G=["date","datetime","time"];return G.indexOf(i)>-1;};C.prototype._getPropertyName=function(){return this._oFactory._oMetaData.property.property.name;};C.prototype._getEntitySetName=function(){return this._oFactory._oMetaData.entitySet.name;};C.prototype._getEntityType=function(){return this._oFactory._oMetaData.entityType;};C.prototype._getValueListAnnotation=function(){return this._oFactory._oMetaData.annotations.valuelist;};C.prototype._getDisplayBehaviour=function(){var i=this._oFactory._getDisplayBehaviourConfiguration("defaultInputFieldDisplayBehaviour");if(!i||i===t.auto){i=t.descriptionAndId;}return i;};C.prototype._getFormattedText=function(K,i){var G=this._getDisplayBehaviour();return s(F.getFormattedExpressionFromDisplayBehaviour(G,K,i));};C.prototype._getFilterType=function(i){if(O.isNumeric(i.type)){return"numeric";}else if(i.type==="Edm.DateTime"&&i["sap:display-format"]==="Date"){return"date";}else if(i.type==="Edm.String"){return"string";}else if(i.type==="Edm.Boolean"){return"boolean";}else if(i.type==="Edm.Time"){return"time";}else if(i.type==="Edm.DateTimeOffset"){return"datetime";}return undefined;};C.prototype.setEntitySet=function(){d.prototype.setEntitySet.apply(this,arguments);this.updateBindingContext(false,this._getModel());return this;};C.prototype.bindProperty=function(i,G){d.prototype.bindProperty.apply(this,arguments);if(i==="value"){this.updateBindingContext(false,this._getModel());}return this;};C.prototype._checkComboBox=function(){var i=this._oFactory._oSelector.checkComboBox();return i&&i.combobox;};C.prototype._isReadMode=function(){return!this.getEditable()||!this.getEnabled()||!this.getContextEditable();};function _(){this._onCreate.apply(this,arguments);if(this._aProviders.length>0){this._aProviders[0]._onOK=E;}}C.prototype._init=function(){var i=this;d.prototype._init.apply(this,arguments);if(this._oFactory){this._oFactory._createMultiInput=this._createMultiInput.bind(this);this._oFactory._createMultiComboBox=this._createMultiComboBox.bind(this);this._oFactory._createTokenizer=this._createTokenizer.bind(this);this._oFactory._onMultiInputCreate=_;this._oFactory._oSelector.getCreator=function(){if(i._isReadMode()){return"_createTokenizer";}else if(i._checkComboBox()){return"_createMultiComboBox";}else{return"_createMultiInput";}};}};C.prototype.exit=function(){this._deregisterResizeHandler();if(this.getBindingContext()){if(this._oMultiInput){this._oMultiInput.unbindAggregation("tokens");}if(this._oMultiComboBox){this._oMultiComboBox.unbindItems();}if(this._oTokenizer){this._oTokenizer.unbindAggregation("tokens");}}d.prototype.exit.apply(this,arguments);};return C;});
