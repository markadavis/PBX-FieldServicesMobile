/*
 * ! SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/thirdparty/jquery','sap/m/library','sap/ui/core/library','sap/ui/core/Core','sap/ui/core/ShortcutHintsMixin','sap/ui/core/format/ListFormat','sap/ui/events/KeyCodes','sap/ui/comp/util/DateTimeUtil','sap/ui/comp/util/FilterUtil','sap/m/Column','sap/m/ColumnListItem','sap/m/Label','sap/m/MessageBox','sap/m/Table','sap/m/Text','sap/m/Title','sap/m/OverflowToolbar','sap/m/ToolbarSpacer','sap/m/OverflowToolbarButton','sap/m/ToolbarSeparator','sap/m/VBox','sap/m/FlexItemData','sap/ui/comp/library','sap/ui/comp/providers/TableProvider','sap/ui/comp/smartfilterbar/FilterProvider','sap/ui/comp/smartvariants/SmartVariantManagement','sap/ui/model/Sorter','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/model/json/JSONModel','sap/ui/table/AnalyticalColumn','sap/ui/table/AnalyticalTable','sap/ui/table/Column','sap/ui/table/Table','sap/ui/table/TreeTable','sap/ui/comp/personalization/Controller','sap/ui/comp/personalization/Util','sap/ui/comp/util/FormatUtil','sap/ui/comp/util/FullScreenUtil','sap/ui/comp/odata/ODataModelUtil','sap/ui/comp/odata/ODataType','sap/ui/comp/state/UIState','sap/ui/comp/smartvariants/PersonalizableInfo','sap/ui/core/format/NumberFormat','sap/ui/Device','sap/base/Log','sap/base/util/deepEqual','sap/base/util/merge',"sap/m/ColumnHeaderPopover",'sap/m/ColumnPopoverActionItem','sap/m/ColumnPopoverSortItem','sap/m/Menu','sap/m/MenuButton','sap/m/MenuItem','sap/m/Button','sap/m/Link','sap/m/MessageStrip','sap/ui/util/openWindow'],function(q,M,c,C,S,L,K,D,F,a,b,d,f,R,T,g,O,h,j,k,V,l,m,n,o,p,r,s,t,J,A,u,v,w,x,y,P,z,B,E,G,U,H,N,I,Q,W,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1){"use strict";var g1=M.ButtonType;var h1=M.MenuButtonMode;var i1=M.ToolbarDesign;var j1=c.SortOrder;var k1=m.smarttable.InfoToolbarBehavior;var l1=V.extend("sap.ui.comp.smarttable.SmartTable",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smarttable/SmartTable.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},enableDataStateFiltering:{type:"boolean",group:"Behavior",defaultValue:false,visibility:"hidden"},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},initiallyVisibleFields:{type:"string",group:"Misc",defaultValue:null},requestAtLeastFields:{type:"string",group:"Misc",defaultValue:null},ignoreFromPersonalisation:{type:"string",group:"Misc",defaultValue:null},tableType:{type:"sap.ui.comp.smarttable.TableType",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},showVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useExportToExcel:{type:"boolean",group:"Misc",defaultValue:true},exportType:{type:"sap.ui.comp.smarttable.ExportType",group:"Misc",defaultValue:"UI5Client"},useTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:sap.ui.core.TitleLevel.Auto},toolbarStyleClass:{type:"string",group:"Misc",defaultValue:null},enableCustomFilter:{type:"boolean",group:"Misc",defaultValue:true},persistencyKey:{type:"string",group:"Misc",defaultValue:null},useOnlyOneSolidToolbar:{type:"boolean",group:"Misc",defaultValue:false},placeToolbarInTable:{type:"boolean",group:"Misc",defaultValue:false},currentVariantId:{type:"string",group:"Misc",defaultValue:null},editable:{type:"boolean",group:"Misc",defaultValue:false},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},tableBindingPath:{type:"string",group:"Misc",defaultValue:null},editTogglable:{type:"boolean",group:"Misc",defaultValue:false},demandPopin:{type:"boolean",group:"Misc",defaultValue:false},showFullScreenButton:{type:"boolean",group:"Misc",defaultValue:false},initialNoDataText:{type:"string",group:"Misc",defaultValue:null},useInfoToolbar:{type:"sap.ui.comp.smarttable.InfoToolbarBehavior",group:"Behavior",defaultValue:k1.Auto},showDetailsButton:{type:"boolean",group:"Misc",defaultValue:false}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},aggregations:{customToolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false},noData:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},semanticKeyAdditionalControl:{type:"sap.ui.core.Control",multiple:false}},events:{initialise:{},beforeRebindTable:{},editToggled:{},dataRequested:{},dataReceived:{},afterVariantInitialise:{},afterVariantSave:{parameters:{currentVariantId:{type:"string"}}},afterVariantApply:{parameters:{currentVariantId:{type:"string"}}},showOverlay:{},fieldChange:{},fullScreenToggled:{parameters:{fullScreen:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"}}},beforePaste:{allowPreventDefault:true,parameters:{columnInfos:{type:"object[]"}}},paste:{parameters:{result:{type:"object"}}}}},renderer:{apiVersion:2},constructor:function(){V.apply(this,arguments);this._aExistingColumns=[];this._aAlwaysSelect=[];this._oTemplate=null;this._mFieldMetadataByKey={};this._createToolbar();this._oP13nDialogSettings=this.data("p13nDialogSettings");if(typeof this._oP13nDialogSettings==="string"){try{this._oP13nDialogSettings=JSON.parse(this._oP13nDialogSettings);}catch(e){this._oP13nDialogSettings=null;}}this._bIsFilterPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.filter)?this._oP13nDialogSettings.filter.visible!==false:true;this._bIsSortPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.sort)?this._oP13nDialogSettings.sort.visible!==false:true;this._createTable();this.attachModelContextChange(this._initialiseMetadata,this);}});l1.prototype.getEnableDataStateFiltering=function(){return this.getProperty("enableDataStateFiltering");};l1.prototype.setEnableDataStateFiltering=function(e){if(this.getEnableDataStateFiltering()===e){return this;}this.setProperty("enableDataStateFiltering",e,true);if(!e){this._onApplyMessageFilter(e);if(this._oDataStateIndicator){this._oDataStateIndicator.detachEvent("dataStateChange",this._onDataStateChange,this);this._oDataStateIndicator.detachEvent("messageLinkPressed",this._onMessageLinkPressed,this);this._oDataStateIndicator=null;}}this._bApplyFilter=false;this._handleDataStateIndicator();return this;};l1.prototype._handleDataStateIndicator=function(){if(!this._oTable||!this.getEnableDataStateFiltering()){return;}var i=this._oTable.getDependents();if(!i.length){return;}var e=i.find(function(n1){return n1.isA("sap.m.plugins.DataStateIndicator");});if(!e){return;}this._oDataStateIndicator=e;this._oDataStateIndicator.attachEvent("dataStateChange",this._onDataStateChange,this);var m1=C.getLibraryResourceBundle("sap.ui.comp");this._oDataStateIndicator.setMessageLinkText(m1.getText("SMARTTABLE_MESSAGESTRIP_FILTER_ITEMS"));this._oDataStateIndicator.setMessageLinkVisible(true);this._oDataStateIndicator.attachEvent("messageLinkPressed",this._onMessageLinkPressed,this);this._oDataStateIndicator.refresh();};l1.prototype.setHeaderLevel=function(e){if(this.getHeaderLevel()===e){return this;}this.setProperty("headerLevel",e,true);this._headerText&&this._headerText.setLevel(e);return this;};l1.prototype._onMessageLinkPressed=function(){this._bApplyFilter=!this._bApplyFilter;this._onApplyMessageFilter(this._bApplyFilter);};l1.prototype._getP13nFilterMessageStrip=function(){var e,i;if(this.getEnableDataStateFiltering()){i=C.getLibraryResourceBundle("sap.ui.comp");e=new e1({text:i.getText("SMARTTABLE_P13N_FILTER_MESSAGESTRIP"),type:"Information",visible:this._bApplyFilter,link:new d1({text:i.getText("SMARTTABLE_MESSAGESTRIP_CLEAR_FILTER"),press:[function(){e.setVisible(false);this._onApplyMessageFilter(false);this._bApplyFilter=!this._bApplyFilter;},this]})});}return e;};l1.prototype._onDataStateChange=function(e){var i=e.getParameter("filteredMessages")||[];this._sDataStateType=e.getSource()._getCombinedType(i).toUpperCase();if(!i.length){this._onApplyMessageFilter(false);}};l1.prototype._onApplyMessageFilter=function(e){this._filterByDataStateError(e);var i=C.getLibraryResourceBundle("sap.ui.comp");if(this._oDataStateIndicator&&!e){this._oDataStateIndicator.setMessageLinkText(i.getText("SMARTTABLE_MESSAGESTRIP_FILTER_ITEMS"));this._getRowBinding().checkDataState();}else if(this._oDataStateIndicator){this._oDataStateIndicator.setMessageLinkText(i.getText("SMARTTABLE_MESSAGESTRIP_CLEAR_FILTER"));}};l1.prototype.init=function(){V.prototype.init.call(this);this.addStyleClass("sapUiCompSmartTable");this.setFitContainer(true);this._aColumnKeys=[];this._aDeactivatedColumns=[];this._mLazyColumnMap={};};l1.prototype._getVariantManagementControl=function(e){var i=null;if(e){if(typeof e==='string'){i=C.byId(e);}else{i=e;}if(i){if(!(i instanceof p)){Q.error("Control with the id="+e.getId?e.getId():e+" not of expected type");return null;}}}return i;};l1.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||(!this.getUseVariantManagement()&&!this.getUseTablePersonalisation())||!this.getPersistencyKey()){return;}var e=new H({type:"table",keyName:"persistencyKey",dataSource:"TODO"});e.setControl(this);var i=this.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}else if(this._oSmartFilter&&this._oSmartFilter.data("pageVariantPersistencyKey")){i=this._oSmartFilter.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}}else{this._oVariantManagement=new p(this.getId()+"-variant",{showShare:true});}if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(e);this._oVariantManagement.attachSave(this._variantSaved,this);this._oVariantManagement.attachAfterSave(this._variantAfterSave,this);this._oVariantManagement.initialise(this._variantInitialised,this);}};l1.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD";}this.fireAfterVariantInitialise();if(this._oVariantManagement&&!this._oVariantManagement.getEnabled()){this._checkAndTriggerBinding();}};l1.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}};l1.prototype._variantAfterSave=function(){this.fireAfterVariantSave({currentVariantId:this.getCurrentVariantId()});};l1.prototype.setTableBindingPath=function(e){this.setProperty("tableBindingPath",e,true);return this;};l1.prototype.setShowTablePersonalisation=function(e){this.setProperty("showTablePersonalisation",e,true);if(this._oTablePersonalisationButton){this._oTablePersonalisationButton.setVisible(e);}return this;};l1.prototype.setUseVariantManagement=function(e){this.setProperty("useVariantManagement",e,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!e);}return this;};l1.prototype.setShowVariantManagement=function(e){this.setProperty("showVariantManagement",e,true);if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(e);if(this._oSeparator){this._oSeparator.setVisible(e);}}return this;};l1.prototype.setToolbarStyleClass=function(e){this.setProperty("toolbarStyleClass",e,true);return this;};l1.prototype.setCustomToolbar=function(e){this._oCustomToolbar=e;return this;};l1.prototype.getCustomToolbar=function(){return this._oCustomToolbar;};l1.prototype.setHeader=function(e){var i=this.getProperty("header"),m1;this.setProperty("header",e,true);if(this.bIsInitialised&&this._oToolbar){m1=(!i===!e);if(!m1){this._createToolbarContent();}else{this._refreshHeaderText();}}return this;};l1.prototype.setShowRowCount=function(e){this.setProperty("showRowCount",e,true);this._refreshHeaderText();return this;};l1.prototype.setEditable=function(e){this.setProperty("editable",e,true);if(this._oEditModel){this._oEditModel.setProperty("/editable",e);}if(this._oEditButton){this._oEditButton.setIcon(e?"sap-icon://display":"sap-icon://edit");}if(this._isMobileTable&&this._oTable.setKeyboardMode){this._oTable.setKeyboardMode(e?"Edit":"Navigation");}return this;};l1.prototype.setDemandPopin=function(e){var i=this.getDemandPopin();if(i===e){return this;}this.setProperty("demandPopin",e,true);if(this.bIsInitialised){if(e){this._updateColumnsPopinFeature();}else{this._deactivateColumnsPopinFeature();}}return this;};l1.prototype._refreshHeaderText=function(){if(!this._headerText){return;}if(!this._oNumberFormatInstance){this._oNumberFormatInstance=N.getFloatInstance();}var e=this.getHeader();this._headerText.setVisible(!!e);if(this.getShowRowCount()){var i=parseInt(this._getRowCount(true));var m1=this._oNumberFormatInstance.format(i);e+=" ("+m1+")";}this._headerText.setText(e);this._updateAriaLabelledByInfo();};l1.prototype._updateAriaLabelledByInfo=function(){var e=this._headerText.getId();if(this._oTable&&this._oTable.addAriaLabelledBy){if(this._headerText.getVisible()){if(this._oTable.getAriaLabelledBy().indexOf(e)===-1){this._oTable.addAriaLabelledBy(e);}}else{this._oTable.removeAriaLabelledBy(e);}}};l1.prototype._addFullScreenButton=function(){if(this._oFullScreenButton){this._oToolbar.removeContent(this._oFullScreenButton);}if(this.getShowFullScreenButton()){if(!this._oFullScreenButton){this._oFullScreenButton=new j(this.getId()+"-btnFullScreen",{press:[function(){this._toggleFullScreen(!this.bFullScreen);},this]});this._oFullScreenButton.addStyleClass("sapUiCompSmartTableToolbarContent");}this._renderFullScreenButton();this._oToolbar.addContent(this._oFullScreenButton);}};l1.prototype._createToolbar=function(){var e=null;if(!this._oToolbar){e=this.getCustomToolbar();if(e){this._oToolbar=e;}else{this._oToolbar=new O({design:i1.Transparent});this._oToolbar.addStyleClass("sapUiCompSmartTableToolbar");if(this.getToolbarStyleClass()){this._oToolbar.addStyleClass(this.getToolbarStyleClass());}}this._oToolbar.setLayoutData(new l({shrinkFactor:0}));}};l1.prototype._toggleShowHideDetails=function(e){if(!this._oShowHideDetailsButton||(e===this.bHideDetails)){return;}this.bHideDetails=e;var i=[];if(this.bHideDetails){i=I.system.phone?["Low","Medium"]:["Low"];}this._oTable.setHiddenInPopin(i);this._renderShowHideDetailsButton();};l1.prototype._renderShowHideDetailsButton=function(){var e=C.getLibraryResourceBundle("sap.ui.comp"),i;i=this.bHideDetails?e.getText("TABLE_SHOWDETAILS_TEXT"):e.getText("TABLE_HIDEDETAILS_TEXT");this._oShowHideDetailsButton.setTooltip(i);this._oShowHideDetailsButton.setText(i);};l1.prototype._toggleFullScreen=function(e,i){if(!this._oFullScreenButton||(e===this.bFullScreen&&!i)){return;}this.bFullScreen=e;B.toggleFullScreen(this,this.bFullScreen,this._oFullScreenButton,this._toggleFullScreen);this._renderFullScreenButton();this.fireFullScreenToggled({fullScreen:e});};l1.prototype._renderFullScreenButton=function(){var e=C.getLibraryResourceBundle("sap.ui.comp"),i;i=this.bFullScreen?e.getText("CHART_MINIMIZEBTN_TOOLTIP"):e.getText("CHART_MAXIMIZEBTN_TOOLTIP");this._oFullScreenButton.setTooltip(i);this._oFullScreenButton.setText(i);this._oFullScreenButton.setIcon(this.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen");};l1.prototype._createToolbarContent=function(){if(!this._oToolbar){this._createToolbar();}this._addVariantManagementToToolbar();this._addSeparatorToToolbar();this._addHeaderToToolbar();this._addSpacerToToolbar();this._addEditTogglableToToolbar();this._addShowHideDetailsButton();this._addTablePersonalisationToToolbar();this._addExportToExcelToToolbar();this._addFullScreenButton();this._bToolbarInsertedIntoItems=true;this._placeToolbar();};l1.prototype._placeToolbar=function(){if(!this.getPlaceToolbarInTable()){this.insertItem(this._oToolbar,0);}else if(this._isMobileTable){this._oTable.setHeaderToolbar(this._oToolbar);}else{this._oTable.addExtension(this._oToolbar);}};l1.prototype.getToolbar=function(){return this._oToolbar;};l1.prototype._addEditTogglableToToolbar=function(){var e;if(this._oEditButton){this._oToolbar.removeContent(this._oEditButton);}if(this.getEditTogglable()){if(!this._oEditButton){e=C.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_EDITTOGGLE_TOOLTIP");this._oEditButton=new j(this.getId()+"-btnEditToggle",{icon:this.getEditable()?"sap-icon://display":"sap-icon://edit",text:e,tooltip:e,press:[function(){var i=this.getEditable();i=!i;this.setEditable(i,true);this.fireEditToggled({editable:i});},this]});this._oEditButton.addStyleClass("sapUiCompSmartTableToolbarContent");}this._oToolbar.addContent(this._oEditButton);}};l1.prototype._addHeaderToToolbar=function(){if(this._headerText){this._oToolbar.removeContent(this._headerText);}if(!this._headerText){this._headerText=new g(this.getId()+"-header");this._headerText.addStyleClass("sapMH4Style");this._headerText.addStyleClass("sapUiCompSmartTableHeader");this._headerText.addStyleClass("sapUiCompSmartTableToolbarContent");this._headerText.setLevel(this.getHeaderLevel());}this._refreshHeaderText();this._oToolbar.insertContent(this._headerText,0);};l1.prototype._addSeparatorToToolbar=function(){if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator);}if(this.getHeader()&&this.getUseVariantManagement()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){if(!this._oSeparator){this._oSeparator=new k(this.getId()+"-toolbarSeperator");if(!this.getShowVariantManagement()){this._oSeparator.setVisible(false);}}this._oToolbar.insertContent(this._oSeparator,0);}if(this._oToolbar){this._oToolbar.addStyleClass("sapMTBHeader-CTX");}};l1.prototype._addVariantManagementToToolbar=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oToolbar.removeContent(this._oVariantManagement);if(this.getUseVariantManagement()){this._oToolbar.insertContent(this._oVariantManagement,0);this._oVariantManagement.addStyleClass("sapUiCompSmartTableToolbarContent");if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(this.getShowVariantManagement());}}}};l1.prototype._addSpacerToToolbar=function(){var e=false,m1=this._oToolbar.getContent(),i,n1;if(m1){n1=m1.length;i=0;for(i;i<n1;i++){if(m1[i]instanceof h){e=true;break;}}}if(!e){this._oToolbar.addContent(new h(this.getId()+"-toolbarSpacer").addStyleClass("sapUiCompSmartTableToolbarContent"));}};l1.prototype._createShowHideDetailsButton=function(){this._oShowHideDetailsButton=new c1(this.getId()+"-btnShowHideDetails",{visible:false,press:[function(){this._toggleShowHideDetails(!this.bHideDetails);},this]});this._oShowHideDetailsButton.addStyleClass("sapUiCompSmartTableToolbarContent");};l1.prototype._addShowHideDetailsButton=function(){if(this._oShowHideDetailsButton){this._oToolbar.removeContent(this._oShowHideDetailsButton);}if(this.getShowDetailsButton()&&this._isMobileTable){this.bHideDetails=true;if(!this._oShowHideDetailsButton){this._createShowHideDetailsButton();}this._renderShowHideDetailsButton();this._oToolbar.addContent(this._oShowHideDetailsButton);}};l1.prototype._addTablePersonalisationToToolbar=function(){var e;if(this._oTablePersonalisationButton){this._oToolbar.removeContent(this._oTablePersonalisationButton);}if(this.getUseTablePersonalisation()){if(!this._oTablePersonalisationButton){e=C.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_PERSOBTN_TOOLTIP");this._oTablePersonalisationButton=new j(this.getId()+"-btnPersonalisation",{icon:"sap-icon://action-settings",text:e,tooltip:e,press:[function(i){this._oPersController.openDialog();},this]});S.addConfig(this._oTablePersonalisationButton,{messageBundleKey:I.os.macintosh?"SMARTTABLE_SHORTCUT_SHOW_SETTINGS_MAC":"SMARTTABLE_SHORTCUT_SHOW_SETTINGS"},this);this._oTablePersonalisationButton.addStyleClass("sapUiCompSmartTableToolbarContent");this._oTablePersonalisationButton.setVisible(this.getShowTablePersonalisation());}this._oToolbar.addContent(this._oTablePersonalisationButton);}};l1.prototype._triggerGWExport=function(){var e=C.getLibraryResourceBundle("sap.ui.comp");var i=function(){var n1=this._getRowBinding();var o1=n1.getDownloadUrl("xlsx");o1=this._removeExpandParameter(o1);if(o1&&o1.length>2048&&I.browser.msie){f.error(e.getText("DOWNLOAD_TOO_COMPLEX_TEXT"));return;}var p1={url:o1};this.fireBeforeExport({exportSettings:p1});f1(p1.url);}.bind(this);var m1=this._getRowCount(true);if(m1>10000){f.confirm(e.getText("DOWNLOAD_CONFIRMATION_TEXT",m1),{actions:[f.Action.YES,f.Action.NO],onClose:function(n1){if(n1===f.Action.YES){i();}}});}else{i();}};l1.prototype._addExportToExcelToToolbar=function(){if(this._oUseExportToExcel){this._oToolbar.removeContent(this._oUseExportToExcel);}if(!this.getUseExportToExcel()){return;}if(!this._oUseExportToExcel){var e=this.getId()+"-btnExcelExport";var i="sap-icon://excel-attachment";var m1=C.getLibraryResourceBundle("sap.ui.comp");if(this.getExportType()==="UI5Client"){this._oUseExportToExcel=this._createClientExportButton(e,i);}if(this._bTableSupportsExcelExport&&this.getExportType()==="GW"){var n1;n1=m1.getText("TABLE_EXPORT_TEXT");this._oUseExportToExcel=new j(e,{icon:i,text:n1,tooltip:n1,press:[this._triggerGWExport,this]});}this._setExcelExportEnableState();if(this._oUseExportToExcel){this._oUseExportToExcel.addStyleClass("sapUiCompSmartTableToolbarContent");}}this._oToolbar.addContent(this._oUseExportToExcel);};l1.prototype._openExportSettings=function(){var e=this;this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils'],function(i){i.getExportSettingsViaDialog(e._cachedExcelSettings,e).then(function(m1){e._cachedExcelSettings=m1;e._triggerUI5ClientExport(m1);});});});};l1.prototype._createClientExportButton=function(e,i){var m1=C.getLibraryResourceBundle("sap.ui.comp");var n1={fileName:this.getHeader()};if(!this._cachedExcelSettings){this._cachedExcelSettings=n1;}var o1=new a1(e,{icon:i,tooltip:m1.getText("TABLE_EXPORT_TEXT"),type:g1.Ghost,buttonMode:h1.Split,useDefaultActionOnly:true,defaultAction:[function(){this._triggerUI5ClientExport(n1);},this],menu:[new _({items:[new b1({text:m1.getText("QUICK_EXPORT"),press:[function(){this._triggerUI5ClientExport(n1);},this]}),new b1({text:m1.getText("EXPORT_WITH_SETTINGS"),press:[this._openExportSettings,this]})]})]});S.addConfig(o1._getButtonControl(),{messageBundleKey:I.os.macintosh?"SMARTTABLE_SHORTCUT_EXPORT_TO_EXCEL_MAC":"SMARTTABLE_SHORTCUT_EXPORT_TO_EXCEL"},this);return o1;};l1.prototype.onkeydown=function(e){if(e.isMarked()){return;}if((e.metaKey||e.ctrlKey)&&e.shiftKey&&e.which===K.E){if(this.getUseExportToExcel()&&this.getExportType()==="UI5Client"&&this._oUseExportToExcel&&this._oUseExportToExcel.getEnabled()){this._openExportSettings();e.setMarked();e.preventDefault();}}else if((e.metaKey||e.ctrlKey)&&e.which===K.COMMA){if(this.getUseTablePersonalisation()&&this._oTablePersonalisationButton&&this._oTablePersonalisationButton.getVisible()){this._oPersController.openDialog();e.setMarked();e.preventDefault();}}};l1.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=C.loadLibrary("sap.ui.export",true);}return this._oExportLibLoadPromise;};l1.prototype._getColumnLabel=function(e){var i;if(typeof e==='string'){e=this._getColumnByKey(e);}if(!e){return null;}if(e.getLabel){i=e.getLabel();}if(e.getHeader){i=e.getHeader();}return(i&&i.getText)?i.getText():null;};l1.prototype._getColumnWidthNumber=function(e){if(e.indexOf("em")>0){return Math.round(parseFloat(e));}if(e.indexOf("px")>0){return Math.round(parseInt(e)/16);}return"";};l1.prototype._triggerUI5ClientExport=function(e){var i=this._createExportColumnConfiguration(e);if(!i||!i.length){f.error(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS_EXPORT"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}var m1=this._getRowBinding();var n1=this._getColumnLabel.bind(this);var o1={workbook:{columns:i,hierarchyLevel:(this._isTreeTable&&m1.getTreeAnnotation)?m1.getTreeAnnotation("hierarchy-level-for"):undefined},dataSource:m1,fileName:e?e.fileName:this.getHeader()};this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils','sap/ui/export/Spreadsheet'],function(p1,q1){var r1=Promise.resolve();if(e.includeFilterSettings){r1=p1.parseFilterConfiguration(m1,n1).then(function(s1){if(e.includeFilterSettings&&s1){o1.workbook.context={metaSheetName:s1.name,metainfo:[s1]};}});}r1.then(function(){var s1={splitCells:false,includeFilterSettings:false};if(e){s1.splitCells=e.splitCells;s1.includeFilterSettings=e.includeFilterSettings;}var t1=new q1(o1);t1.attachBeforeExport(function(v1){this.fireBeforeExport({exportSettings:v1.getParameter('exportSettings'),userExportSettings:s1});},this);var u1=function(){t1.destroy();};t1.build().then(u1,u1);}.bind(this));}.bind(this));}.bind(this));};l1.prototype._createExportColumnConfiguration=function(e){var m1,i,n1,o1,p1,q1,r1,s1,t1,u1,v1,w1,x1,y1,z1,A1,B1,C1,D1=[];var E1=e&&e.splitCells;var F1=function(H1,I1){return'{'+(parseInt(I1)-1)+'}';};m1=this._isMobileTable?this._oTable.getColumns(true):this._oTable.getColumns();n1=m1.length;for(i=0;i<n1;i++){r1=null;s1=null;t1=null;o1=m1[i];if(o1.getVisible()){p1=o1.data("p13nData");if(o1.getLeadingProperty){r1=o1.getLeadingProperty();}if(!r1&&p1){r1=p1["leadingProperty"];}if(Array.isArray(r1)){r1=r1[0];}if(r1){q1=this._getColumnLabel(o1);y1=o1.getWidth().toLowerCase()||p1.width||"";y1=this._getColumnWidthNumber(y1);z1=p1.type==="numeric"?"Number":p1.type;C1=p1.typeInstance;B1=null;A1=null;if(p1.unit){z1=p1.isCurrency?"Currency":"Number";if(E1){t1=p1.unit;}}else if(C1&&C1.isA("sap.ui.comp.odata.type.FiscalDate")){var G1=C1.getFormatter();s1=G1.getTemplate().replace(/\$(\d)/g,F1);A1=G1.getRegExPattern().toString().slice(1,-1);z1="String";}else if(z1!="date"&&G.isDateOrTime(p1.edmType)){z1=G.getTypeName(p1.edmType);if(z1==="DateTimeOffset"){z1="DateTime";}}else if(z1==="stringdate"){z1="Date";A1="YYYYMMDD";}else if(z1==="boolean"){z1="Boolean";B1=G.getType(p1.edmType);}else if(p1.description){z1="String";if(!E1){s1=z.getFormattedExpressionFromDisplayBehaviour(p1.displayBehaviour,"{0}","{1}");}else if(p1.displayBehaviour==="descriptionOnly"){r1=p1.description;}else if(p1.displayBehaviour!=="idOnly"){t1=p1.description;}}else if(p1.isDigitSequence){z1="Number";}else if(z1==="string"){z1="String";}else if(z1==="date"){z1="Date";}else if(z1==="time"){z1="Time";}D1.push({columnId:o1.getId(),property:p1.description&&!E1?[r1,p1.description]:r1,type:z1,inputFormat:A1,label:q1?q1:r1,width:y1,textAlign:o1.getHAlign(),template:s1,trueValue:(z1==="Boolean"&&B1)?B1.formatValue(true,"string"):undefined,falseValue:(z1==="Boolean"&&B1)?B1.formatValue(false,"string"):undefined,unitProperty:(z1==="Currency"||(z1==="Number"&&!E1))?p1.unit:undefined,displayUnit:z1==="Currency"&&!E1,precision:p1.precision,scale:p1.scale});if(t1){u1=this._getColumnByKey(t1);v1=q1;q1=null;if(u1){q1=this._getColumnLabel(u1);y1=u1.getWidth().toLowerCase()||"";y1=this._getColumnWidthNumber(y1);x1=u1.getHAlign();}else{w1=this._mFieldMetadataByKey[t1];if(w1){q1=w1.label;y1=w1.width;}}D1.push({columnId:o1.getId()+"-additionalProperty",property:t1,type:"String",label:q1||(v1?v1+" (2)":t1),width:y1,textAlign:x1});}}}}return D1;};l1.prototype._removeExpandParameter=function(e){var i=e.replace(new RegExp("([\\?&]\\$expand=[^&]+)(&?)"),function(m1,n1,o1){return o1?n1.substring(0,1):"";});return i;};l1.prototype._getRowCount=function(e){var i=this._getRowBinding();if(!i){return 0;}var m1=0;if(e&&i.getTotalSize){m1=i.getTotalSize();}else{m1=i.getLength();}if(m1<0||m1==="0"){m1=0;}return m1;};l1.prototype._setExcelExportEnableState=function(){if(this._oUseExportToExcel){var i=this._getRowCount();this._oUseExportToExcel.setEnabled(i>0);}};l1.prototype._createPersonalizationController=function(){if(this._oPersController||!this.getUseTablePersonalisation()){return;}var e=this._oP13nDialogSettings;e=this._setIgnoreFromPersonalisationToSettings(e);e=e||{};if(this._isTreeTable){e.stableColumnKeys=[];e.stableColumnKeys.push(this._aColumnKeys[0]);}if(this._bIsFilterPanelEnabled){e.filter=e.filter?e.filter:{};e.filter.createMessageStrip=this._getP13nFilterMessageStrip.bind(this);}this._oPersController=new y(this.getId()+"-persoController",{table:this._oTable,columnKeys:this._aColumnKeys,setting:e,resetToInitialTableState:!this.getUseVariantManagement(),beforePotentialTableChange:[this._beforePersonalisationModelDataChange,this],afterPotentialTableChange:[this._afterPersonalisationModelDataChange,this],afterP13nModelDataChange:[this._personalisationModelDataChange,this],requestColumns:[this._personalisationRequestColumns,this]});};l1.prototype._setIgnoreFromPersonalisationToSettings=function(e){var i=P.createArrayFromString(this.getIgnoreFromPersonalisation());if(i.length){if(!e){e={};}var m1=function(n1){if(!e[n1]){e[n1]={};}e[n1].ignoreColumnKeys=i;};m1("filter");m1("sort");m1("group");m1("columns");}return e;};l1.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};l1.prototype.setEntitySet=function(e){this.setProperty("entitySet",e,true);this._initialiseMetadata();return this;};l1.prototype._initialiseMetadata=function(e){var i=this,m1=i;if(e){m1=e.getSource();}if(!m1.bIsInitialised){E.handleModelInit(m1,m1._onMetadataInitialised);}};l1.prototype._onMetadataInitialised=function(){this._bMetaModelLoadAttached=false;if(!this.bIsInitialised){this._createTableProvider();if(this._oTableProvider){this._aTableViewMetadata=this._oTableProvider.getTableViewMetadata();if(this._aTableViewMetadata){if(!this._isMobileTable&&this.getDemandPopin()){this.setDemandPopin(false);Q.error("use SmartTable property 'demandPopin' only  with responsive table, property has been set to false");}this.detachModelContextChange(this._initialiseMetadata,this);this.bIsInitialised=true;this._bTableSupportsExcelExport=this._oTableProvider.getSupportsExcelExport();this._bMultiUnitBehaviorEnabled=this._oTableProvider.getMultiUnitBehaviorEnabled();this._listenToSmartFilter();this._createVariantManagementControl();this._createToolbarContent();this._aAlwaysSelect=this._oTableProvider.getRequestAtLeastFields();this._createContent();this._createPersonalizationController();this._oEditModel=new J({editable:this.getEditable()});this.setModel(this._oEditModel,"sm4rtM0d3l");this.attachEvent("_change",this._onPropertyChange,this);this.fireInitialise();if(!this._oVariantManagement||(this._oVariantManagement&&this._bVariantInitialised)){this._checkAndTriggerBinding();}}}}};l1.prototype._checkAndTriggerBinding=function(){if(!this._bAutoBindingTriggered){this._bAutoBindingTriggered=true;if(this.getEnableAutoBinding()){if(this._oSmartFilter){if(this._oSmartFilter.isInitialised()){this._oSmartFilter.search();}else{this._oSmartFilter.attachEventOnce("initialise",function(){this._oSmartFilter.search();},this);}}else{this._reBindTable();}}}};l1.prototype._aStaticProperties=["entitySet","ignoredFields","initiallyVisibleFields","ignoreFromPersonalisation","tableType","useTablePersonalisation","enableAutoBinding","persistencyKey","smartFilterId","showDetailsButton"];l1.prototype._aToolbarRelatedProperties=["useExportToExcel","exportType","showFullScreenButton","editTogglable","placeToolbarInTable"];l1.prototype._onPropertyChange=function(e){var i=e.getParameter("name");if(this._aStaticProperties.indexOf(i)>-1){Q.error("Property "+i+" cannot be changed after the SmartTable with id "+this.getId()+" is initialised");}if(this._oToolbar&&this._aToolbarRelatedProperties.indexOf(i)>-1){if(i==="exportType"&&this._oUseExportToExcel){this._oUseExportToExcel.destroy();this._oUseExportToExcel=null;}this._createToolbarContent();}};l1.prototype._createTableProvider=function(){var e,i,m1;i=this.getEntitySet();m1=this.getIgnoredFields();e=this.getModel();if(e&&i){if(this._aExistingColumns.length){if(m1){m1+=","+this._aExistingColumns.toString();}else{m1=this._aExistingColumns.toString();}}this._oTableProvider=new n({entitySet:i,ignoredFields:m1,initiallyVisibleFields:this.getInitiallyVisibleFields(),isEditableTable:this.getEditable(),smartTableId:this.getId(),isAnalyticalTable:!!this._isAnalyticalTable,isMobileTable:!!this._isMobileTable,dateFormatSettings:this.data("dateFormatSettings"),useUTCDateTime:this.data("useUTCDateTime"),currencyFormatSettings:this.data("currencyFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDropDownDisplayBehaviour"),useSmartField:this.data("useSmartField"),useSmartToggle:this.data("useSmartToggle"),skipAnnotationParse:this.data("skipAnnotationParse"),lineItemQualifier:this.data("lineItemQualifier"),presentationVariantQualifier:this.data("presentationVariantQualifier"),enableInResultForLineItem:this.data("enableInResultForLineItem"),_semanticKeyAdditionalControl:this.getAggregation("semanticKeyAdditionalControl"),model:e,semanticObjectController:this.getSemanticObjectController(),showDetailsButton:this.getShowDetailsButton()});}};l1.prototype._listenToSmartFilter=function(){var e,i,m1=false;e=this.getSmartFilterId();this._oSmartFilter=this._findControl(e,"sap.ui.comp.filterbar.FilterBar");if(this._oSmartFilter){this._oSmartFilter.attachSearch(this._reBindTable,this);this._oSmartFilter.attachFilterChange(this._filterChangeEvent,this);m1=true;}i=this.getInitialNoDataText();if(i){m1=i==="$FILTERBAR";if(!m1&&i!=="$NO_FILTERBAR"){this._setNoDataText(i);return;}}if(m1){this._setNoDataText(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA"));}else{this._setNoDataText(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR"));}};l1.prototype._filterChangeEvent=function(){if(this._isTableBound()&&this._oSmartFilter&&!this._oSmartFilter.getLiveMode()&&!this._oSmartFilter.isDialogOpen()){this._showOverlay(true);}};l1.prototype._showOverlay=function(e){if(e){var i={show:true};this.fireShowOverlay({overlay:i});e=i.show;}this._oTable.setShowOverlay(e);};l1.prototype._findControl=function(i,e){var m1,n1;if(i){m1=C.byId(i);if(!m1||!m1.isA(e)){n1=this._getView();if(n1){m1=n1.byId(i);}}if(m1&&!m1.isA(e)){m1=undefined;}}return m1;};l1.prototype._getView=function(){if(!this._oView){var e=this.getParent();while(e){if(e.isA("sap.ui.core.mvc.View")){this._oView=e;break;}e=e.getParent();}}return this._oView;};l1.prototype.rebindTable=function(e){this._reBindTable(null,e);};l1.prototype._reBindTable=function(e,m1){var n1,o1,p1,i,q1,r1,s1=[],t1,u1,v1,w1,x1,y1,z1,A1={},B1={preventTableBind:false};p1=this._getTablePersonalisationData()||{};if(this._oMessageFilter){t1=this._oMessageFilter;}else{t1=p1.filters;u1=p1.excludeFilters;}z1=p1.sorters;if(this._oSmartFilter){r1=this._oSmartFilter.getFilters();A1=this._oSmartFilter.getParameters()||{};}if(r1&&r1.length){if(u1){s1=[new s([r1[0],u1],true)];}else{s1=r1;}}else if(u1){s1=[u1];}if(t1){t1=s1.concat(t1);}else{t1=s1;}v1=this._getRequestAtLeastFields();x1=this._getRelevantColumnPaths();w1=x1["select"];if(!w1||!w1.length){w1=v1;}else{q1=v1.length;for(i=0;i<q1;i++){if(w1.indexOf(v1[i])<0){w1.push(v1[i]);}}}if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.select){this._mSelectExpandForGroup.select.forEach(function(E1){if(w1.indexOf(E1)<0){w1.push(E1);}});}if(w1.length){A1["select"]=w1.toString();y1=x1["expand"]||[];if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.expand){this._mSelectExpandForGroup.expand.forEach(function(E1){if(y1.indexOf(E1)<0){y1.push(E1);}});}if(y1.length){A1["expand"]=y1.join(",");}}A1["useBatchRequests"]=true;if(!z1){z1=[];}B1.filters=t1;B1.sorter=z1;B1.parameters=A1;B1.length=undefined;B1.startIndex=undefined;B1.events={};this.fireBeforeRebindTable({bindingParams:B1,messageFilterActive:!!this._bApplyFilter});if(!B1.preventTableBind){z1=B1.sorter;t1=B1.filters;A1=B1.parameters;w1=B1.parameters["select"];if(!w1||!w1.length){f.error(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}o1=this.getTableBindingPath()||("/"+this.getEntitySet());if(this._oTable.resumeUpdateAnalyticalInfo){this._oTable.resumeUpdateAnalyticalInfo(true,false);}this._bDataLoadPending=true;this._bIgnoreChange=false;if(this._bForceTableUpdate){m1=true;this._bForceTableUpdate=false;}if(!m1){n1=this._oTable.getBinding(this._sAggregation);if(n1&&n1.mParameters){m1=!(W(A1,n1.mParameters,true)&&W(A1.custom,n1.mParameters.custom)&&!B1.length&&!B1.startIndex&&o1===n1.getPath());}}if(!this._bNoDataUpdated){this._bNoDataUpdated=true;this._setNoDataText();}if(!n1||!this._bIsTableBound||m1){l1._addBindingListener(B1,"change",this._onBindingChange,this);l1._addBindingListener(B1,"dataRequested",this._onDataRequested,this);l1._addBindingListener(B1,"dataReceived",this._onDataReceived,this);if(this._isMobileTable){var C1=this._oTable?this._oTable.getColumns():[];var D1=this._oTemplate?this._oTemplate.getCells():[];if(C1.length===D1.length){C1.forEach(function(E1,F1){D1[F1].setBindingContext(E1.getVisible()?undefined:null);});}}this._oTable.bindRows({path:o1,filters:t1,sorter:z1,parameters:A1,length:B1.length,startIndex:B1.startIndex,template:this._oTemplate,events:B1.events});this._bIsTableBound=true;}else{n1.sort(z1);n1.filter(t1,"Application");}this._showOverlay(false);}};l1.prototype._onDataRequested=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=true;this.fireDataRequested(e.getParameters());};l1.prototype._onDataReceived=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=false;this._onDataLoadComplete(e,true);this.fireDataReceived(e);};l1.prototype._onBindingChange=function(e){if(this._bIgnoreChange){return;}var i,m1=false;i=(e&&e.getParameter)?e.getParameter("reason"):undefined;if(!i||i==="filter"||i==="context"||(!this._bDataLoadPending&&i==="change")){m1=true;}if(i==="change"||m1){this._onDataLoadComplete(e,m1);}};l1._addBindingListener=function(e,i,m1,n1){if(!e.events){e.events={};}if(!e.events[i]){e.events[i]=m1.bind(n1);}else{var o1=e.events[i];e.events[i]=function(){m1.apply(n1,arguments);o1.apply(n1,arguments);};}};l1.prototype._onDataLoadComplete=function(e,i){if(this._bDataLoadPending||i){this._bDataLoadPending=false;this.updateTableHeaderState();}};l1.prototype._isTableBound=function(){if(this._bIsTableBound){return true;}if(this._oTable){return this._oTable.isBound(this._sAggregation);}return false;};l1.prototype.setNoData=function(e){this._oNoData=e;if(this._bNoDataUpdated||this._isTableBound()){this._setNoDataText();}return this;};l1.prototype.getNoData=function(){return this._oNoData;};l1.prototype._setNoDataText=function(e){var i=this._oTable.setNoData;if(!i){i=this._oTable.setNoDataText;}if(!i){return;}var m1=e;if(!m1){m1=this.getNoData();}if(!m1){m1=C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_RESULTS");}i.call(this._oTable,m1,true);};l1.prototype.updateTableHeaderState=function(){this._refreshHeaderText();this._setExcelExportEnableState();};l1.prototype._createContent=function(){var i,e=0,m1,n1,o1,p1=[];if(this._aExistingColumns&&this._aExistingColumns.length){this._aColumnKeys=[].concat(this._aExistingColumns.reverse());}n1=this._parseIndexedColumns();e=this._aTableViewMetadata.length;for(i=0;i<e;i++){m1=this._aTableViewMetadata[i];if(m1.isInitiallyVisible){this._aColumnKeys.push(m1.name);}else{p1.push(m1.name);}if(!(m1.isInitiallyVisible||m1.inResult)){this._mLazyColumnMap[m1.name]=m1;}else{o1=this._createColumnForField(m1);this._oTable.addColumn(o1);}this._mFieldMetadataByKey[m1.name]=m1;}this._insertIndexedColumns(n1);this._aColumnKeys=this._aColumnKeys.concat(p1);this._updateColumnsPopinFeature();if(this.getShowDetailsButton()){this._oTable.setHiddenInPopin(I.system.phone?["Low","Medium"]:["Low"]);}this._storeInitialColumnSettings();};l1.prototype._createColumnForField=function(e){var i,m1;m1=this.getId()+"-"+e.name.replace(/[^A-Za-z0-9_.:-]+/g,"_");i=this._createColumn(e,m1);e.isColumnCreated=true;i.data("p13nData",{columnKey:e.name,leadingProperty:e.name,additionalProperty:e.additionalProperty,navigationProperty:e.navigationProperty,sortProperty:e.sortable?e.name:undefined,filterProperty:e.filterable?e.name:undefined,isGroupable:e.sortable&&e.filterable&&e.aggregationRole==="dimension",fullName:e.hasValueListAnnotation?e.fullName:null,type:e.filterType,typeInstance:e.modelType,maxLength:e.maxLength,precision:e.precision,scale:e.scale,align:e.align,edmType:e.type,displayBehaviour:e.displayBehaviour,description:e.description,isDigitSequence:e.isDigitSequence,isCurrency:e.isCurrencyField,unit:e.unit,width:e.width,aggregationRole:e.aggregationRole,nullable:e.nullable!=="false"});if(e.filterable&&i.setFilterProperty){i.setFilterProperty(e.name);}if(e.sortable&&i.setSortProperty){i.setSortProperty(e.name);}this._registerContentTemplateEvents(e.template);return i;};l1.prototype._parseIndexedColumns=function(){var i,e,m1,n1,o1,p1,q1,r1,s1;var t1=this._oTable.getColumns();var u1=null;if(this._oTemplate&&this._oTemplate.getCells){u1=this._oTemplate.getCells();}if(!t1){return null;}n1=[];e=t1.length;for(i=0;i<e;i++){m1=t1[i];o1=m1.data("p13nData");p1=null;q1=null;if(o1){p1=o1.columnIndex;q1=o1.columnKey;}r1=-1;if(p1!==null&&p1!==undefined){r1=parseInt(p1);}if(!isNaN(r1)&&r1>-1){if(u1){s1=u1[i];this._oTemplate.removeCell(s1);}else{s1=null;}this._aColumnKeys.splice(i-n1.length,1);n1.push({index:r1,columnKey:q1,column:m1,template:s1});this._oTable.removeColumn(m1);}}n1.sort(function(v1,w1){return v1.index-w1.index;});return n1;};l1.prototype._insertIndexedColumns=function(e){var i,m1,n1;if(!e){return;}m1=e.length;for(i=0;i<m1;i++){n1=e[i];this._aColumnKeys.splice(n1.index,0,n1.columnKey);this._oTable.insertColumn(n1.column,n1.index);if(n1.template){this._oTemplate.insertCell(n1.template,n1.index);}}};l1.prototype._updateColumnsPopinFeature=function(){if(!this._isMobileTable||!this.getDemandPopin()){return;}if(!this._oTable.getAutoPopinMode()){this._oTable.setAutoPopinMode(true);}var e=this._oTable.getColumns(true);if(!e){return;}e=e.filter(function(i){return i.getVisible();});e.forEach(function(i){if(i.getPopinDisplay()!="WithoutHeader"){i.setPopinDisplay("Inline");}});};l1.prototype._storeInitialColumnSettings=function(){this._aInitialSorters=[];P.createSort2Json(this._oTable,this._aInitialSorters,P.createArrayFromString(this.getIgnoreFromPersonalisation()));};l1.prototype._deactivateColumnsPopinFeature=function(){if(!this._isMobileTable){return;}if(this._oTable.getAutoPopinMode()){this._oTable.setAutoPopinMode(false);}var e=this._oTable.getColumns();if(!e){return;}var m1,n1=e.length;for(var i=0;i<n1;i++){m1=e[i];m1.setDemandPopin(false);m1.setMinScreenWidth("1px");}};l1.prototype._registerContentTemplateEvents=function(e){if(e.isA("sap.ui.comp.SmartToggle")){e=e.getEdit();}if(e&&e.attachChange){e.attachChange(function(i){this.fireFieldChange({changeEvent:i});},this);}};l1.prototype._updateInitialColumns=function(){var i=this._oTable.getColumns(),m1=i?i.length:0,n1,o1,p1;while(m1--){p1=null;n1=i[m1];if(n1){o1=n1.data("p13nData");if(typeof o1==="string"){try{o1=JSON.parse(o1);}catch(e){}if(o1){n1.data("p13nData",o1);}}if(o1){p1=o1["columnKey"];}if(p1){this._aExistingColumns.push(p1);}}}};l1.prototype._getRelevantColumnPaths=function(){var e={},m1=[],n1=[],o1=this._oTable.getColumns(),i,p1=o1?o1.length:0,q1,r1,s1,t1,u1;var v1=function(s1,w1){var x1,y1;if(s1){y1=s1.split(",");x1=y1.length;while(x1--){s1=y1[x1];if(s1&&w1.indexOf(s1)<0){w1.push(s1);}}}};for(i=0;i<p1;i++){q1=o1[i];s1=null;if(q1.getVisible()||(q1.getInResult&&q1.getInResult())){if(q1.getLeadingProperty){s1=q1.getLeadingProperty();}r1=q1.data("p13nData");if(r1){if(!s1){s1=r1["leadingProperty"];}t1=r1["additionalProperty"];u1=r1["navigationProperty"];}if(s1&&m1.indexOf(s1)<0){m1.push(s1);}v1(t1,m1);v1(u1,n1);}}e["select"]=m1;e["expand"]=n1;return e;};l1.prototype._createTable=function(){var e=this.getItems(),i=e?e.length:0,m1,n1;this._sAggregation="rows";while(i--){m1=e[i];if(m1 instanceof w||m1 instanceof R){break;}m1=null;}if(m1){this._oTable=m1;if(m1 instanceof u){this._isAnalyticalTable=true;}else if(m1 instanceof R){this._isMobileTable=true;this._oTemplate=(m1.getItems()&&m1.getItems().length>0)?m1.getItems()[0]:new b();m1.removeAllItems();}else if(m1 instanceof x){this._isTreeTable=true;}this._updateInitialColumns();}else{n1=this.getId()+"-ui5table";if(this.getTableType()==="AnalyticalTable"){this._isAnalyticalTable=true;this._oTable=new u(n1,{enableCustomFilter:true});}else if(this.getTableType()==="ResponsiveTable"){this._isMobileTable=true;this._oTable=new R(n1,{growing:true,autoPopinMode:this.getDemandPopin()});this._oTemplate=new b();}else if(this.getTableType()==="TreeTable"){this._isTreeTable=true;this._oTable=new x(n1,{selectionMode:"MultiToggle"});}else{this._oTable=new w(n1,{selectionMode:"MultiToggle"});}if(this._oTable.setVisibleRowCountMode){this._oTable.setVisibleRowCountMode("Auto");}this.insertItem(this._oTable,2);}if(!this._oTable.getLayoutData()){if(this._oTable instanceof R||(this._oTable.getVisibleRowCountMode&&this._oTable.getVisibleRowCountMode()!=="Auto")){this._oTable.setLayoutData(new l({growFactor:1,baseSize:"auto"}));}else{this._oTable.setLayoutData(new l({growFactor:1,baseSize:"0%"}));}}this._oTable.addStyleClass("sapUiCompSmartTableInnerTable");this._oTable.setEnableBusyIndicator(true);this._oTable.setBusyIndicatorDelay(100);if(this._oTable.setEnableCustomFilter){this._oTable.setEnableCustomFilter(this.getEnableCustomFilter());}if(this._oTable.setShowColumnVisibilityMenu){this._oTable.setShowColumnVisibilityMenu(false);}if(this._oTable.getEnableCustomFilter&&this._oTable.getEnableCustomFilter()&&this._bIsFilterPanelEnabled){if(this._oTable.setEnableCellFilter){this._oTable.setEnableCellFilter(false);}if(this._oTable.attachCustomFilter){this._oTable.attachCustomFilter(this._onCustomFilter,this);}}if(this._isAnalyticalTable){this._createColumn=this._createAnalyticalColumn;}else if(this._isMobileTable){if(this.getUseTablePersonalisation()){this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onColumnPress,this);this._oTable.attachSort=function(){this.attachEvent("sort",arguments[0],arguments[1],arguments[2]);};this._oTable.detachSort=function(){this.detachEvent("sort",arguments[0],arguments[1]);};}this._sAggregation="items";this._createColumn=this._createMobileColumn;this._oTable.bindRows=this._oTable.bindItems;if(this.getShowDetailsButton()){this._oTable.attachEvent("popinChanged",this._onPopinChanged,this);}}if(!this._isMobileTable){this._oTable.attachEvent("_rowsUpdated",function(){this._setExcelExportEnableState();},this);}if(this._oTable._setLargeDataScrolling){this._oTable._setLargeDataScrolling(true);}this._oTable.attachPaste(this._onInnerTablePaste,this);};l1.prototype._createResponsivePopover=function(){this._oFilterButton=new Z({text:C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_RP_FILTER"),icon:"sap-icon://filter",press:[function(e){this._onCustomFilter(e);},this]});this._oSortButton=new $({sort:[function(e){this._onCustomSort(e);},this]});this._oColumnHeaderPopover=new Y({items:[this._oSortButton,this._oFilterButton]});};l1.prototype._onColumnPress=function(e){this._oColumnClicked=e.getParameter("column");var i=this._oColumnClicked.data("p13nData");if(!i){return;}var m1=i.filterProperty;var n1=i.sortProperty;if(!this._oColumnHeaderPopover){this._createResponsivePopover();}this._oFilterButton.setVisible(!!m1&&this._bIsFilterPanelEnabled);this._oSortButton.setVisible(!!n1&&this._bIsSortPanelEnabled);if((m1&&this._bIsFilterPanelEnabled)||(n1&&this._bIsSortPanelEnabled)){this._oColumnHeaderPopover.removeAllAriaLabelledBy();this._oColumnHeaderPopover.addAriaLabelledBy(this._oColumnClicked.getHeader());this._oColumnHeaderPopover.openBy(this._oColumnClicked);}};l1.prototype._filterByDataStateError=function(e){if(!e){var i=!!this._oMessageFilter;this._oMessageFilter=null;this._createInfoToolbar();if(i){this.rebindTable();}}else{var m1=this._getRowBinding();if(m1&&this._oDataStateIndicator){var n1=this._oDataStateIndicator,o1=n1.getFilter(),p1=o1?function(q1){return o1(q1,n1.getControl());}:undefined;m1.requestFilterForMessages(p1).then(function(q1){if(!q1){return;}this._oMessageFilter=q1;this.rebindTable();this._createInfoToolbar(true);}.bind(this));}}};l1.prototype._onCustomSort=function(){var e=this._oColumnClicked.data("p13nData");if(e){if(!e.sorted){e.sorted={"ascending":true};this._oColumnClicked.data("p13nData",e);}else{e.sorted.ascending=!e.sorted.ascending;}}var i=e.sorted;var m1=i&&i.ascending;this._oTable.fireEvent("sort",{column:this._oColumnClicked,sortOrder:m1?j1.Ascending:j1.Descending,columnAdded:false});};l1.prototype._onCustomFilter=function(e){this._showTableFilterDialog(e.getParameter("column")||this._oColumnClicked);};l1.prototype._onPopinChanged=function(e){if(!this._oShowHideDetailsButton){this._createShowHideDetailsButton();}var i=e.getParameter("hasPopin");var m1=e.getParameter("hiddenInPopin");var n1=e.getSource().getVisibleItems();if(n1.length&&(m1.length||(i&&!this.bHideDetails))){this._oShowHideDetailsButton.setVisible(true);}else{this._oShowHideDetailsButton.setVisible(false);}};l1.prototype.getTable=function(){return this._oTable;};l1.prototype._showTableFilterDialog=function(e){if(this._oPersController){var i={filter:{visible:true}};if(e){i.filter["payload"]={column:e};}this._oPersController.openDialog(i);}};l1.prototype._createColumn=function(e,i){var m1;m1=new v(i,{autoResizable:true,hAlign:e.align,width:e.width,visible:e.isInitiallyVisible,label:new d(i+"-header",{textAlign:e.align,text:e.label}),sorted:e.sorted,sortOrder:e.sortOrder,tooltip:e.quickInfo,showSortMenuEntry:e.sortable&&this._bIsSortPanelEnabled,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,name:e.fieldName,template:e.template});return m1;};l1.prototype._createAnalyticalColumn=function(e,i){var m1;if(e.aggregationRole!=="measure"&&e.isMeasureField&&e.unit&&e.template.addStyleClass){e.template.addStyleClass("sapUiAnalyticalTableSumCellHidden sapUiAnalyticalTableGroupCellHidden");}else if(e.isCurrencyField&&e.template.addStyleClass){e.template.addStyleClass("sapUiCompCurrencyBold");}m1=new A(i,{autoResizable:true,hAlign:e.align,width:e.width,visible:e.isInitiallyVisible,inResult:e.inResult,label:new d(i+"-header",{textAlign:e.align,text:e.label}),tooltip:e.quickInfo,sorted:e.sorted,sortOrder:e.sortOrder,grouped:e.grouped,showIfGrouped:e.grouped,showSortMenuEntry:e.sortable&&this._bIsSortPanelEnabled,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,summed:e.summed,leadingProperty:e.name,template:e.template,groupHeaderFormatter:z.getInlineGroupFormatterFunction(e,true,this._getDateFormatSettings())});return m1;};l1.prototype._createMobileColumn=function(e,i){var m1;m1=new a(i,{hAlign:e.align,visible:e.isInitiallyVisible,header:new d(i+"-header",{textAlign:e.align,text:e.label,tooltip:e.quickInfo,wrapping:true,wrappingType:M.WrappingType.Hyphenated}),tooltip:e.quickInfo,width:e.isImageURL?"3em":undefined});if(this.getShowDetailsButton()&&e.importance){m1.setImportance(e.importance);}if(this._oTemplate){this._oTemplate.addCell(e.template);}return m1;};l1.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{};}return this._oCurrentVariant;};l1.prototype.applyVariant=function(e,i){this._oCurrentVariant=e;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null;}this._bApplyingVariant=true;if(this._oTable._setSuppressRefresh){this._oTable._setSuppressRefresh(true);}if(this._oPersController){if(this._oCurrentVariant===null||q.isEmptyObject(this._oCurrentVariant)){this._oPersController.resetPersonalization("ResetFull");}else{this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId()});};l1.prototype.variantsInitialized=function(){this._bVariantInitialised=true;this._checkAndTriggerBinding();};l1.prototype.getUiState=function(){var e=this._oPersController?this._oPersController.getDataSuiteFormatSnapshot():null;return new U({presentationVariant:{SortOrder:e?e.SortOrder:[],GroupBy:e?e.GroupBy:[],Total:e?e.Total:[],RequestAtLeast:this._getRequestAtLeastFields(),Visualizations:e?e.Visualizations:[]},selectionVariant:{SelectOptions:e?e.SelectOptions:[]},variantName:this.getCurrentVariantId()});};l1.prototype.setUiState=function(e){this._setUiState(e,false);};l1.prototype.setUiStateAsVariant=function(e){this._setUiState(e,true);};l1.prototype._setUiState=function(e,i){var m1=e.getPresentationVariant()&&e.getPresentationVariant().RequestAtLeast?[].concat(e.getPresentationVariant().RequestAtLeast):[];if(!W(m1,this._getRequestAtLeastFields())){this._aAlwaysSelect=m1;}if(this._oPersController){if(i){this._oPersController.setPersonalizationDataAsDataSuiteFormat(X({},e.getPresentationVariant(),e.getSelectionVariant()),true);}else{var n1=(this._oVariantManagement&&e.getVariantName())?this._oVariantManagement.getVariantContent(this,e.getVariantName()):{};this._oPersController.setDataSuiteFormatSnapshot(X({},e.getPresentationVariant(),e.getSelectionVariant()),n1,true);}}};l1.prototype._getRequestAtLeastFields=function(){var e=this.getRequestAtLeastFields();var i=e?e.split(","):[];return i.concat(this._aAlwaysSelect);};l1.prototype._personalisationRequestColumns=function(e){var m1=e.getParameter("columnKeys"),n1,i,o1,p1,q1,r1={};o1=m1.length;for(i=0;i<o1;i++){n1=m1[i];p1=this._mLazyColumnMap[n1];if(p1){q1=this._createColumnForField(p1);if(this._isMobileTable){this._oTable.addColumn(q1);}r1[p1.name]=q1;}}this._oPersController.addColumns(r1);};l1.prototype._beforePersonalisationModelDataChange=function(e){if(this._oTable.suspendUpdateAnalyticalInfo){this._oTable.suspendUpdateAnalyticalInfo();}};l1.prototype._afterPersonalisationModelDataChange=function(e){this._updateColumnsPopinFeature();};l1.prototype._personalisationModelDataChange=function(e){this._oCurrentVariant=e.getParameter("persistentData");var i=e.getParameter("runtimeDeltaDataChangeType");var m1=this._getChangeStatus(i);if(m1==="Unchanged"){return;}if(!(this._bApplyingVariant||this._bDeactivatingColumns)){if(!this.getUseVariantManagement()){this._persistPersonalisation();}else if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true);}}if(m1==="ModelChanged"&&this._isTableBound()){if(i&&i.columns==="ModelChanged"){this._bForceTableUpdate=true;}if(this._oSmartFilter){this._oSmartFilter.search();}else{this._reBindTable(null);}}if(this._isMobileTable){this._adaptCustomSort();}this._createInfoToolbar();};l1.prototype._adaptCustomSort=function(){if(this._oCurrentVariant){var e,i,m1,n1=[],o1;if(this._oCurrentVariant.sort&&this._oCurrentVariant.sort.sortItems){n1=this._oCurrentVariant.sort.sortItems;}this._oTable.getColumns().forEach(function(p1){e=p1.data("p13nData");i=e&&e.columnKey;if(i){m1=n1.filter(function(q1){return i===q1.columnKey;});o1=m1[0];if(o1){if(!e.sorted){e.sorted={"ascending":false};}if(o1.operation!==j1.Descending){e.sorted={"ascending":true};}p1.setSortIndicator(o1.operation);}else if(e&&e.sorted){e.sorted=null;p1.setSortIndicator(c.None);}}else if(p1.getSortIndicator()!==j1.None){p1.setSortIndicator(j1.None);}},this);}};l1.prototype.setUseInfoToolbar=function(e){this.setProperty("useInfoToolbar",e,true);if(this.getTable()){this._createInfoToolbar();}return this;};l1.prototype._updateInfoToolbar=function(i,e){if(!this._oInfoToolbar){this._oInfoToolbar=new O({active:true,visible:true,design:i1.Info,content:[new T({id:this.getId()+"-infoToolbarText",text:i,wrapping:false})],press:[e,this._handleInfoToolbarPress,this]});}else{this._oInfoToolbar.setVisible(true);this._oInfoToolbar.getContent()[0].setText(i);this._oInfoToolbar.detachPress(this._handleInfoToolbarPress,this);this._oInfoToolbar.attachPress(e,this._handleInfoToolbarPress,this);}};l1.prototype._handleInfoToolbarPress=function(e,i){this._showTableFilterDialog(i);};l1.prototype._createInfoToolbar=function(e){var i=this.getUseInfoToolbar(),m1=this.getTable(),n1=this.getId()+"-infoToolbarText",o1,p1=C.getLibraryResourceBundle("sap.ui.comp");if(i===k1.Off){if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);m1.removeAriaLabelledBy(n1);}return;}if(e){var q1=p1.getText("SMARTTABLE_INFOTOOLBAR_FILTERED_BY",[p1.getText("SMARTTABLE_INFOTOOLBAR_MESS_"+this._sDataStateType)]);this._updateInfoToolbar(q1);if(this._isMobileTable&&!m1.getInfoToolbar()){m1.setInfoToolbar(this._oInfoToolbar);}else if(!this._isMobileTable){var r1=m1.getExtension().some(function(x1){return x1.getId()===this._oInfoToolbar.getId();},this);if(!r1){m1.addExtension(this._oInfoToolbar);}}if(m1.getAriaLabelledBy().indexOf(n1)===-1){m1.addAriaLabelledBy(n1);}}else if(this._isMobileTable){if(m1.getInfoToolbar()&&!this._oInfoToolbar){Q.error("Custom infoToolbar is used, hence set useInfoToolbar property on the SmartTable with id='"+this.getId()+"' to Off");return;}var s1=this._oCurrentVariant&&this._oCurrentVariant.filter&&this._oCurrentVariant.filter.filterItems,t1=s1&&s1.length;if(t1){var u1=[],v1=L.getInstance();s1.forEach(function(x1){var y1=this._getColumnLabel(x1.columnKey);if(y1&&u1.indexOf(y1)===-1){u1.push(y1);}},this);var w1=p1.getText("SMARTTABLE_INFOTOOLBAR_FILTERED_BY",[v1.format(u1)]);o1=this._getColumnByKey(s1[0].columnKey);this._updateInfoToolbar(w1,o1);if(!m1.getInfoToolbar()){m1.setInfoToolbar(this._oInfoToolbar);}if(m1.getAriaLabelledBy().indexOf(n1)===-1){m1.addAriaLabelledBy(n1);}}else if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);m1.removeAriaLabelledBy(n1);}}else if(this._oInfoToolbar){this._oInfoToolbar.setVisible(false);}};l1.prototype._getChangeStatus=function(e){if(!e){return"ModelChanged";}if(e.sort==="ModelChanged"||e.filter==="ModelChanged"||e.columns==="ModelChanged"||e.group==="ModelChanged"){return"ModelChanged";}if(e.sort==="TableChanged"||e.filter==="TableChanged"||e.columns==="TableChanged"||e.group==="TableChanged"){return"TableChanged";}return"Unchanged";};l1.prototype._getDateFormatSettings=function(){if(this._oTableProvider&&this._oTableProvider._oDateFormatSettings){return this._oTableProvider._oDateFormatSettings;}return undefined;};l1.prototype._getTablePersonalisationData=function(){this._mSelectExpandForGroup=null;if(!this._oCurrentVariant){return null;}var e=[],i=[],m1=[],n1,o1,p1,q1,r1,s1,t1,u1,v1,w1,x1={},y1={},z1="",A1;if(this._isMobileTable&&this._oCurrentVariant.group&&this._oCurrentVariant.group.groupItems){o1=this._oCurrentVariant.group.groupItems[0];if(this._aDeactivatedColumns.indexOf(o1.columnKey)<0){r1=this._getColumnByKey(o1.columnKey);if(r1){z1=r1.getHeader().getText();}w1=this._getPathFromColumnKeyAndProperty(o1.columnKey,"sortProperty");}if(w1){t1=w1;u1=null;var B1=this._mFieldMetadataByKey[o1.columnKey],C1;if(B1){u1=B1.unit||B1.description;C1=z.getInlineGroupFormatterFunction(B1,false,this._getDateFormatSettings());}p1=new r(t1,o1.operation==="GroupDescending",function(F1){var G1=F1.getProperty(t1),H1;if(C1){if(u1){H1=F1.getProperty(u1);}G1=C1(G1,H1);}if(G1===undefined||G1===null){G1="";}return{key:G1,text:z1?z1+": "+G1:G1};});this._mSelectExpandForGroup={select:[t1]};if(B1){if(B1.additionalProperty){this._mSelectExpandForGroup.select.push(B1.additionalProperty);}if(B1.navigationProperty){this._mSelectExpandForGroup.expand=[B1.navigationProperty];}}e.push(p1);}}if(this._oCurrentVariant.sort){q1=this._oCurrentVariant.sort.sortItems;}else{q1=this._aInitialSorters;}if(q1){q1.forEach(function(F1,G1){var H1=F1.operation==="Descending";w1=null;v1=null;if(this._aDeactivatedColumns.indexOf(F1.columnKey)<0){w1=this._getPathFromColumnKeyAndProperty(F1.columnKey,"sortProperty");}if(w1){if(p1&&p1.sPath===w1){p1.bDescending=H1;}else{var B1=this._mFieldMetadataByKey[F1.columnKey];if(!B1){r1=this._getColumnByKey(F1.columnKey);s1=r1.data("p13nData");}if(this._bMultiUnitBehaviorEnabled&&((B1&&B1.isCurrencyField)||(s1&&s1.isCurrency))){v1=B1?B1.unit:s1.unit;if(v1&&!x1[v1]){x1[v1]={index:G1,descending:H1};}}y1[w1]={};if(y1[v1]){delete x1[v1];}else if(x1[w1]){delete x1[w1];}e.push(new r(w1,H1));}}},this);var D1=Object.keys(x1),E1;if(D1.length){D1.reverse().forEach(function(F1){E1=p1?x1[F1].index+1:x1[F1].index;e.splice(E1,0,new r(F1,x1[F1].descending));});}}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(F1){var G1=F1.value1,H1=F1.value2,I1;w1=null;A1=false;r1=null;if(this._aDeactivatedColumns.indexOf(F1.columnKey)<0){r1=this._getColumnByKey(F1.columnKey);}if(r1){if(r1.getFilterProperty){w1=r1.getFilterProperty();}s1=r1.data("p13nData");if(s1){A1=s1.type==="time";if(!w1){w1=s1["filterProperty"];}}}if(w1){if(A1){if(G1 instanceof Date){G1=z.getEdmTimeFromDate(G1);}if(H1 instanceof Date){H1=z.getEdmTimeFromDate(H1);}}else{var J1=s1&&s1.typeInstance&&s1.typeInstance.getName()==="sap.ui.model.odata.type.DateTimeOffset";if(G1 instanceof Date&&!J1&&this._oTableProvider&&this._oTableProvider.getIsUTCDateHandlingEnabled()){G1=D.localToUtc(G1);H1=H1?D.localToUtc(H1):H1;}}var K1=(F1.exclude?m1:i);if(F1.operation==="Empty"){var L1=F1.exclude?t.NE:t.EQ;if(s1.edmType==="Edm.String"||s1.type==="string"){K1.push(new s(w1,L1,""));}if(s1.nullable){K1.push(new s(w1,L1,null));}}else{I1=F1.exclude?F.getTransformedExcludeOperation(F1.operation):F1.operation;K1.push(new s(w1,I1,G1,H1));}}},this);if(m1.length){n1=new s(m1,true);}}return{filters:i,excludeFilters:n1,sorters:e};};l1.prototype._getColumnByKey=function(e){var m1,n1,o1,i,p1;if(this._oTable){m1=this._oTable.getColumns();o1=m1.length;for(i=0;i<o1;i++){n1=m1[i];p1=n1.data("p13nData");if(p1&&p1.columnKey===e){return n1;}}}return null;};l1.prototype._getPathFromColumnKeyAndProperty=function(e,i){var m1=null,n1,o1;n1=this._getColumnByKey(e);if(n1){if(i=="sortProperty"&&n1.getSortProperty){m1=n1.getSortProperty();}else if(i=="filterProperty"&&n1.getFilterProperty){m1=n1.getFilterProperty();}else if(i=="leadingProperty"&&n1.getLeadingProperty){m1=n1.getLeadingProperty();}if(!m1){o1=n1.data("p13nData");if(o1){m1=o1[i];}}}return m1;};l1.prototype._persistPersonalisation=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){var e=this.getCurrentVariantId();if(!this._bSaving){this._bSaving=true;this._oVariantManagement.fireSave({name:"Personalisation",implicit:true,global:false,overwrite:!!e,key:e,def:true});delete this._bSaving;}}};l1.prototype.getCurrentVariantId=function(){return this._oVariantManagement?this._oVariantManagement.getCurrentVariantId():"";};l1.prototype.setCurrentVariantId=function(e){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantId(e);}else{Q.error("sap.ui.comp.smarttable.SmartTable.prototype.setCurrentVariantId: VariantManagement does not exist, or is a page variant");}return this;};l1.prototype.isInitialised=function(){return!!this.bIsInitialised;};l1.prototype._aAvailablePanels=["Columns","Sort","Filter","Group"];l1.prototype.openPersonalisationDialog=function(e){if(!e||this._aAvailablePanels.indexOf(e)<0){Q.warning("sap.ui.comp.smarttable.SmartTable.prototype.openPersonalisationDialog: "+e+" is not a valid panel!");return;}if(this._oPersController){var i={};i[e.toLowerCase()]={visible:true};this._oPersController.openDialog(i);}};l1.prototype.deactivateColumns=function(e){this._aDeactivatedColumns=e||[];this._bDeactivatingColumns=true;if(this._oPersController){this._oPersController.addToSettingIgnoreColumnKeys(this._aDeactivatedColumns);}this._bDeactivatingColumns=false;};l1.prototype._onInnerTablePaste=function(e){if(!this.hasListeners("beforePaste")&&!this.hasListeners("paste")){return;}var i=e.getParameter("data");var m1=i.slice(0);var n1=this._getColumnInfoForPaste();if(this.fireBeforePaste({columnInfos:n1})){sap.ui.require(["sap/ui/core/util/PasteHelper"],function(o1){o1.parse(m1,n1).then(function(p1){this.firePaste({result:p1});}.bind(this));}.bind(this));}};l1.prototype._getColumnInfoForPaste=function(){var e=[],m1=this._oTable.getColumns(),i,n1=m1.length,o1,p1,q1,r1,s1,t1;if(this._isMobileTable&&m1.length){m1=m1.sort(function(w1,x1){return w1.getOrder()-x1.getOrder();});}for(i=0;i<n1;i++){o1=m1[i];q1=null;t1=null;s1=null;if(o1.getVisible()){if(o1.getLeadingProperty){q1=o1.getLeadingProperty();}p1=o1.data("p13nData");if(!q1&&p1){q1=p1["leadingProperty"];}r1=p1.type==="numeric"?"number":p1.type;if(p1.type==="date"){var u1=this._getDateFormatSettings();if(u1&&u1["UTC"]){var v1={displayFormat:"Date"};s1=G.getType("Edm.DateTime",u1,v1);}}if(!s1){s1=p1["typeInstance"];}if(p1.isCurrency||r1==="number"){t1=p1.unit;}else if(p1.description&&p1.displayBehaviour!=="idOnly"){t1=p1.description;}}e.push({columnId:o1.getId(),property:q1,ignore:!q1,type:s1});s1=G.getType("Edm.String");if(t1){e.push({columnId:o1.getId(),additionalProperty:true,property:t1,type:s1});}}return e;};l1.prototype.exit=function(){var i,e;this.detachEvent("_change",this._onPropertyChange,this);if(this._oSmartFilter){this._oSmartFilter.detachSearch(this._reBindTable,this);this._oSmartFilter.detachFilterChange(this._filterChangeEvent,this);this._oSmartFilter=null;}if(this._oTableProvider&&this._oTableProvider.destroy){this._oTableProvider.destroy();}this._oTableProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy();}this._oPersController=null;if(this._oVariantManagement){this._oVariantManagement.detachSave(this._variantSaved,this);this._oVariantManagement.detachAfterSave(this._variantAfterSave,this);if(!this._oVariantManagement.isPageVariant()&&this._oVariantManagement.destroy){this._oVariantManagement.destroy();}}this._oNumberFormatInstance=null;B.cleanUpFullScreen(this);if(this._oEditModel){this._oEditModel.destroy();}if(this._oNoData&&this._oNoData.destroy){this._oNoData.destroy();}this.oNoData=null;if(this._aTableViewMetadata){i=this._aTableViewMetadata.length;while(i--){e=this._aTableViewMetadata[i];if(e&&!e.isColumnCreated&&e.template){e.template.destroy();}}}if(this._oShowHideDetailsButton){this._oShowHideDetailsButton.destroy();}this._oShowHideDetailsButton=null;this._aTableViewMetadata=null;this._mFieldMetadataByKey=null;this._mSelectExpandForGroup=null;this._oEditModel=null;this._oVariantManagement=null;this._oCurrentVariant=null;this._aExistingColumns=null;this._mLazyColumnMap=null;this._aColumnKeys=null;this._aDeactivatedColumns=null;this._aAlwaysSelect=null;this._oCustomToolbar=null;if(this._oToolbar&&!this._bToolbarInsertedIntoItems){this._oToolbar.destroy();}this._oToolbar=null;if(this._oUseExportToExcel&&!this.getUseExportToExcel()){this._oUseExportToExcel.destroy();}this._oUseExportToExcel=null;this._oTablePersonalisationButton=null;this._oP13nDialogSettings=null;if(this._oTemplate){this._oTemplate.destroy();}this._oTemplate=null;if(this._oColumnHeaderPopover){this._oColumnHeaderPopover.destroy();}this._oColumnHeaderPopover=null;this._oFilterButton=null;this._oSortButton=null;this._oInfoToolbar=null;this._oView=null;this._oTable=null;};return l1;});
