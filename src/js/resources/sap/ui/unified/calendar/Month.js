/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/Device','sap/ui/core/LocaleData','sap/ui/core/delegate/ItemNavigation','sap/ui/unified/calendar/CalendarUtils','sap/ui/unified/calendar/CalendarDate','sap/ui/unified/DateRange','sap/ui/unified/DateTypeRange','sap/ui/unified/library','sap/ui/core/format/DateFormat','sap/ui/core/library','sap/ui/core/Locale',"./MonthRenderer","sap/ui/dom/containsOrEquals","sap/ui/events/KeyCodes","sap/ui/thirdparty/jquery",'sap/ui/core/InvisibleMessage',"sap/ui/core/Configuration","sap/ui/core/date/CalendarWeekNumbering","sap/ui/core/date/CalendarUtils","sap/base/Log"],function(C,D,L,I,a,b,c,d,l,e,f,g,M,h,K,q,j,k,m,n,o){"use strict";var p=f.CalendarType;var r=l.CalendarDayType;var s=C.extend("sap.ui.unified.calendar.Month",{metadata:{library:"sap.ui.unified",properties:{date:{type:"object",group:"Data"},intervalSelection:{type:"boolean",group:"Behavior",defaultValue:false},singleSelection:{type:"boolean",group:"Behavior",defaultValue:true},showHeader:{type:"boolean",group:"Appearance",defaultValue:false},firstDayOfWeek:{type:"int",group:"Appearance",defaultValue:-1},nonWorkingDays:{type:"int[]",group:"Appearance",defaultValue:null},primaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance"},secondaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance"},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},showWeekNumbers:{type:"boolean",group:"Appearance",defaultValue:true},calendarWeekNumbering:{type:"sap.ui.core.date.CalendarWeekNumbering",group:"Appearance",defaultValue:null}},aggregations:{selectedDates:{type:"sap.ui.unified.DateRange",multiple:true,singularName:"selectedDate"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:true,singularName:"specialDate"},disabledDates:{type:"sap.ui.unified.DateRange",multiple:true,singularName:"disabledDate"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{select:{},focus:{parameters:{date:{type:"object"},otherMonth:{type:"boolean"},restoreOldDate:{type:"boolean"}}},weekNumberSelect:{allowPreventDefault:true,parameters:{weekNumber:{type:"int"},weekDays:{type:"sap.ui.unified.DateRange"}}}}}});s.prototype.init=function(){var i=sap.ui.getCore().getConfiguration().getCalendarType();this.setProperty("primaryCalendarType",i);this.setProperty("secondaryCalendarType",i);this._oFormatYyyymmdd=e.getInstance({pattern:"yyyyMMdd",calendarType:p.Gregorian});this._oFormatLong=e.getInstance({style:"long",calendarType:i});this._mouseMoveProxy=q.proxy(this._handleMouseMove,this);this._iColumns=7;this._aVisibleDays=[];this._oMinDate=a._minDate(this.getPrimaryCalendarType());this._oMaxDate=a._maxDate(this.getPrimaryCalendarType());};s.prototype._getAriaRole=function(){return"gridcell";};s.prototype.exit=function(){if(this._oItemNavigation){this.removeDelegate(this._oItemNavigation);this._oItemNavigation.destroy();delete this._oItemNavigation;}if(this._sInvalidateMonth){clearTimeout(this._sInvalidateMonth);}this._aVisibleDays=null;};s.prototype.getFocusDomRef=function(){return this._oItemNavigation.getItemDomRefs()[this._oItemNavigation.getFocusedIndex()];};s.prototype.onBeforeRendering=function(){if(this.getFirstDayOfWeek()!==-1&&this.getCalendarWeekNumbering()!=="Default"){o.warning("Both properties firstDayOfWeek and calendarWeekNumbering should not be used at the same time!");}};s.prototype.onAfterRendering=function(){_.call(this);A.call(this);};s.prototype.onmouseover=function(E){var T=q(E.target),S=this.getSelectedDates()[0],i,B;if(!this._isMarkingUnfinishedRangeAllowed()){return;}if(!T.hasClass('sapUiCalItemText')&&!T.hasClass('sapUiCalItem')){return;}if(T.hasClass('sapUiCalItemText')){T=T.parent();}i=parseInt(this._oFormatYyyymmdd.format(S.getStartDate()));B=T.data("sapDay");if(this.hasListeners("datehovered")){this.fireEvent("datehovered",{date1:i,date2:B});}else{this._markDatesBetweenStartAndHoveredDate(i,B);}};s.prototype._markDatesBetweenStartAndHoveredDate=function(B,E){var F,$,G,i;F=this.$().find(".sapUiCalItem");if(B>E){B=B+E;E=B-E;B=B-E;}for(i=0;i<F.length;i++){$=q(F[i]);G=$.data('sapDay');if(G>B&&G<E){$.addClass('sapUiCalItemSelBetween');}else{$.removeClass('sapUiCalItemSelBetween');}}};s.prototype.onsapfocusleave=function(E){if(!E.relatedControlId||!h(this.getDomRef(),sap.ui.getCore().byId(E.relatedControlId).getFocusDomRef())){if(this._bMouseMove){this._unbindMousemove(true);var S=this._selectDay(this._getDate());if(!S&&this._oMoveSelectedDate){this._selectDay(this._oMoveSelectedDate);}this._bMoveChange=false;this._bMousedownChange=false;this._oMoveSelectedDate=undefined;z.call(this);}if(this._bMousedownChange){this._bMousedownChange=false;z.call(this);}}};s.prototype.removeAllSelectedDates=function(){this._bDateRangeChanged=true;var R=this.removeAllAggregation("selectedDates");return R;};s.prototype.destroySelectedDates=function(){this._bDateRangeChanged=true;var i=this.destroyAggregation("selectedDates");return i;};s.prototype.removeAllSpecialDates=function(){this._bDateRangeChanged=true;var R=this.removeAllAggregation("specialDates");return R;};s.prototype.destroySpecialDates=function(){this._bDateRangeChanged=true;var i=this.destroyAggregation("specialDates");return i;};s.prototype.removeAllDisabledDates=function(){this._bDateRangeChanged=true;var R=this.removeAllAggregation("disabledDates");return R;};s.prototype.destroyDisabledDates=function(){this._bDateRangeChanged=true;var i=this.destroyAggregation("disabledDates");return i;};s.prototype.setDate=function(i){var B=b.fromLocalJSDate(i,this.getPrimaryCalendarType());v.call(this,B,false);return this;};s.prototype._setDate=function(i){var B=i.toLocalJSDate();this.setProperty("date",B,true);this._oDate=i;};s.prototype._getDate=function(){if(!this._oDate){this._oDate=b.fromLocalJSDate(new Date(),this.getPrimaryCalendarType());}return this._oDate;};s.prototype.displayDate=function(i){var B=b.fromLocalJSDate(i,this.getPrimaryCalendarType());v.call(this,B,true);return this;};s.prototype.setPrimaryCalendarType=function(i){this.setProperty("primaryCalendarType",i);this._oFormatLong=e.getInstance({style:"long",calendarType:i});if(this._oDate){this._oDate=new b(this._oDate,i);}return this;};s.prototype.setSecondaryCalendarType=function(i){this._bSecondaryCalendarTypeSet=true;this.setProperty("secondaryCalendarType",i);this.invalidate();this._oFormatSecondaryLong=e.getInstance({style:"long",calendarType:i});return this;};s.prototype._getSecondaryCalendarType=function(){var S;if(this._bSecondaryCalendarTypeSet){S=this.getSecondaryCalendarType();var P=this.getPrimaryCalendarType();if(S===P){S=undefined;}}return S;};s.prototype._getLocale=function(){var P=this.getParent();if(P&&P.getLocale){return P.getLocale();}else if(!this._sLocale){this._sLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString();}return this._sLocale;};s.prototype._getLocaleData=function(){var P=this.getParent();if(P&&P._getLocaleData){return P._getLocaleData();}else if(!this._oLocaleData){var i=this._getLocale();var B=new g(i);this._oLocaleData=L.getInstance(B);}return this._oLocaleData;};s.prototype._getFormatLong=function(){var i=this._getLocale();if(this._oFormatLong.oLocale.toString()!==i){var B=new g(i);this._oFormatLong=e.getInstance({style:"long",calendarType:this.getPrimaryCalendarType()},B);if(this._oFormatSecondaryLong){this._oFormatSecondaryLong=e.getInstance({style:"long",calendarType:this._getSecondaryCalendarType()},B);}}return this._oFormatLong;};s.prototype.getIntervalSelection=function(){var P=this.getParent();if(P&&P.getIntervalSelection){return P.getIntervalSelection();}else{return this.getProperty("intervalSelection");}};s.prototype.getSingleSelection=function(){var P=this.getParent();if(P&&P.getSingleSelection){return P.getSingleSelection();}else{return this.getProperty("singleSelection");}};s.prototype.getSelectedDates=function(){var P=this.getParent();if(P&&P.getSelectedDates){return P.getSelectedDates();}else{return this.getAggregation("selectedDates",[]);}};s.prototype.getSpecialDates=function(){var P=this.getParent();if(P&&P.getSpecialDates){return P.getSpecialDates();}else{return this.getAggregation("specialDates",[]);}};s.prototype.getDisabledDates=function(){var P=this.getParent();if(P&&P.getDisabledDates){return P.getDisabledDates();}else{return this.getAggregation("disabledDates",[]);}};s.prototype.getPrimaryCalendarType=function(){var P=this.getParent();if(P&&P.getPrimaryCalendarType){return P.getPrimaryCalendarType();}return this.getProperty("primaryCalendarType");};s.prototype._getShowHeader=function(){var P=this.getParent();if(P&&P._getShowMonthHeader){return P._getShowMonthHeader();}else{return this.getProperty("showHeader");}};s.prototype.getAriaLabelledBy=function(){var P=this.getParent();if(P&&P.getAriaLabelledBy){return P.getAriaLabelledBy();}else{return this.getAssociation("ariaLabelledBy",[]);}};s.prototype.getLegend=function(){var P=this.getParent();if(P&&P.getLegend){return P.getLegend();}else{return this.getAssociation("legend",[]);}};s.prototype._getFirstDayOfWeek=function(){var P=this.getParent();var F=0;if(P&&P.getFirstDayOfWeek){F=P.getFirstDayOfWeek();}else{F=this.getProperty("firstDayOfWeek");}if(F<0||F>6){var W=n.getWeekConfigurationValues(this.getCalendarWeekNumbering(),new g(this._getLocale()));if(W){F=W.firstDayOfWeek;}else{var i=this._getLocaleData();F=i.getFirstDayOfWeek();}}return F;};s.prototype._getNonWorkingDays=function(){var P=this.getParent();var N;if(P&&P.getNonWorkingDays){N=P.getNonWorkingDays();}else{N=this.getProperty("nonWorkingDays");}if(N&&!Array.isArray(N)){N=[];}return N;};s.prototype._checkDateSelected=function(B){a._checkCalendarDate(B);var S=0;var E=this.getSelectedDates();var T=B.toUTCJSDate().getTime();var F=this.getPrimaryCalendarType();for(var i=0;i<E.length;i++){var R=E[i];var G=R.getStartDate();var H=0;if(G){G=b.fromLocalJSDate(G,F);H=G.toUTCJSDate().getTime();}var J=R.getEndDate();var N=0;if(J){J=b.fromLocalJSDate(J,F);N=J.toUTCJSDate().getTime();}if(T===H&&!J){S=1;break;}else if(T===H&&J){S=2;if(J&&T===N){S=5;}break;}else if(J&&T===N){S=3;break;}else if(J&&T>H&&T<N){S=4;break;}if(this.getSingleSelection()){break;}}return S;};s.prototype._getDateTypes=function(B){a._checkCalendarDate(B);var T,E,N,F=[];var S=this._getSpecialDates();var G=B.toUTCJSDate().getTime();var U=new Date(Date.UTC(0,0,1));for(var i=0;i<S.length;i++){var R=S[i];var H=R.getStartDate();var J=a.MAX_MILLISECONDS;if(H){U.setUTCFullYear(H.getFullYear(),H.getMonth(),H.getDate());J=U.getTime();}var O=R.getEndDate();var P=-a.MAX_MILLISECONDS;if(O){U.setUTCFullYear(O.getFullYear(),O.getMonth(),O.getDate());P=U.getTime();}N=R.getType()===r.NonWorking;if((G===J&&!O)||(G>=J&&G<=P)){if(!N&&!T){T={type:R.getType(),tooltip:R.getTooltip_AsString(),color:R.getColor()};F.push(T);}else if(N&&!E){E={type:R.getType(),tooltip:R.getTooltip_AsString()};F.push(E);}if(T&&E){break;}}}return F;};s.prototype._checkDateEnabled=function(B){a._checkCalendarDate(B);var E=true;var F=this.getDisabledDates();var T=B.toUTCJSDate().getTime();var G=this.getPrimaryCalendarType();var P=this.getParent();if(P&&P._oMinDate&&P._oMaxDate){if(T<P._oMinDate.valueOf()||T>P._oMaxDate.valueOf()){return false;}}for(var i=0;i<F.length;i++){var R=F[i];var S=R.getStartDate();var H=0;if(S){S=b.fromLocalJSDate(S,G);H=S.toUTCJSDate().getTime();}var J=R.getEndDate();var N=0;if(J){J=b.fromLocalJSDate(J,G);N=J.toUTCJSDate().getTime();}if(J){if(T>H&&T<N){E=false;break;}}else if(T===H){E=false;break;}}return E;};s.prototype._handleMouseMove=function(E){if(!this.$().is(":visible")){this._unbindMousemove(true);}var T=q(E.target);if(T.hasClass("sapUiCalItemText")){T=T.parent();}if(this._sLastTargetId&&this._sLastTargetId===T.attr("id")){return;}this._sLastTargetId=T.attr("id");if(T.hasClass("sapUiCalItem")){var O=this._getDate();if(!h(this.getDomRef(),E.target)){var S=this.getSelectedDates();if(S.length>0&&this.getSingleSelection()){var i=S[0].getStartDate();if(i){i=b.fromLocalJSDate(i,this.getPrimaryCalendarType());}var B=b.fromLocalJSDate(this._oFormatYyyymmdd.parse(T.attr("data-sap-day")));if(B.isSameOrAfter(i)){x.call(this,i,B);}else{x.call(this,B,i);}}}else{var F=b.fromLocalJSDate(this._oFormatYyyymmdd.parse(T.attr("data-sap-day")),this.getPrimaryCalendarType());if(!F.isSame(O)){if(T.hasClass("sapUiCalItemOtherMonth")){this.fireFocus({date:F.toLocalJSDate(),otherMonth:true});}else{this._setDate(F);var G=this._selectDay(F,true);if(G){this._oMoveSelectedDate=new b(F,this.getPrimaryCalendarType());}this._bMoveChange=true;}}}}};s.prototype.onmousedown=function(E){this._oMousedownPosition={clientX:E.clientX,clientY:E.clientY};if(!!E.button||D.support.touch||!this._isWeekSelectionAllowed()||!E.target.classList.contains("sapUiCalWeekNum")){return;}var $=q(E.target),i=$.siblings().eq(0).attr("data-sap-day"),P=this._oFormatYyyymmdd.parse(i),F=b.fromLocalJSDate(P,this.getPrimaryCalendarType());this._handleWeekSelection(F,true);};s.prototype.onmouseup=function(E){var N=E.button!==2;if(this._bMouseMove){this._unbindMousemove(true);var F=this._getDate();var B=this._oItemNavigation.getItemDomRefs();for(var i=0;i<B.length;i++){var $=q(B[i]);if(!$.hasClass("sapUiCalItemOtherMonth")){if($.attr("data-sap-day")===this._oFormatYyyymmdd.format(F.toUTCJSDate(),true)){$.trigger("focus");break;}}}if(this._bMoveChange){var S=this._selectDay(F);if(!S&&this._oMoveSelectedDate){this._selectDay(this._oMoveSelectedDate);}this._bMoveChange=false;this._bMousedownChange=false;this._oMoveSelectedDate=undefined;z.call(this);}}if(this._bMousedownChange){this._bMousedownChange=false;z.call(this);}else if(D.support.touch&&N&&this._areMouseEventCoordinatesInThreshold(E.clientX,E.clientY,10)){var G=E.target.classList,H=(G.contains("sapUiCalItemText")||G.contains("sapUiCalDayName")),J=G.contains("sapUiCalWeekNum"),O=this._getSelectedDateFromEvent(E);if(J&&this._isWeekSelectionAllowed()){this._handleWeekSelection(O,true);}else if(H&&E.shiftKey&&this._isConsecutiveDaysSelectionAllowed()){this._handleConsecutiveDaysSelection(O);}else if(H){this._selectDay(O,false,false);z.call(this);}}};s.prototype.onsapselect=function(E){if(this.bSpaceButtonPressed){return;}var S=this._selectDay(this._getSelectedDateFromEvent(E));if(S){z.call(this);}E.stopPropagation();E.preventDefault();};s.prototype.onkeydown=function(E){if(E.which===K.SPACE){this.bSpaceButtonPressed=true;}};s.prototype.onkeyup=function(E){if(E.which===K.SPACE){this.bSpaceButtonPressed=false;}};s.prototype.onsapselectmodifiers=function(E){var S=this._getSelectedDateFromEvent(E),F;if(this._isWeekSelectionAllowed()&&E.shiftKey&&E.keyCode===K.SPACE){F=a._getFirstDateOfWeek(S);this._handleWeekSelection(F,false);}else if(this._isConsecutiveDaysSelectionAllowed()&&E.shiftKey&&E.keyCode===K.ENTER){this._handleConsecutiveDaysSelection(S);}E.preventDefault();};s.prototype.onsappageupmodifiers=function(E){var F=new b(this._getDate(),this.getPrimaryCalendarType());var Y=F.getYear();if(E.metaKey||E.ctrlKey){F.setYear(Y-10);}else{F.setYear(Y-1);}this.fireFocus({date:F.toLocalJSDate(),otherMonth:true});E.preventDefault();};s.prototype.onsappagedownmodifiers=function(E){var F=new b(this._getDate(),this.getPrimaryCalendarType());var Y=F.getYear();if(E.metaKey||E.ctrlKey){F.setYear(Y+10);}else{F.setYear(Y+1);}this.fireFocus({date:F.toLocalJSDate(),otherMonth:true});E.preventDefault();};s.prototype._updateSelection=function(){var S=this.getSelectedDates();if(S.length>0){var i=this.getPrimaryCalendarType();var B=S.map(function(F){var G=F.getStartDate();if(G){return b.fromLocalJSDate(G,i);}});var E=S[0].getEndDate();if(E){E=b.fromLocalJSDate(E,i);}x.call(this,B,E);}};s.prototype._isValueInThreshold=function(R,V,T){var i=R-T,U=R+T;return V>=i&&V<=U;};s.prototype._areMouseEventCoordinatesInThreshold=function(i,B,T){return this._oMousedownPosition&&this._isValueInThreshold(this._oMousedownPosition.clientX,i,T)&&this._isValueInThreshold(this._oMousedownPosition.clientY,B,T)?true:false;};s.prototype._bindMousemove=function(F){q(window.document).on('mousemove',this._mouseMoveProxy);this._bMouseMove=true;if(F){this.fireEvent("_bindMousemove");}};s.prototype._unbindMousemove=function(F){q(window.document).off('mousemove',this._mouseMoveProxy);this._bMouseMove=undefined;this._sLastTargetId=undefined;if(F){this.fireEvent("_unbindMousemove");}};s.prototype.onThemeChanged=function(){if(this._bNoThemeChange||!this.getDomRef()){return;}var W=this.getDomRef().querySelectorAll(".sapUiCalWH:not(.sapUiCalDummy)"),B=this._getLocaleData(),S=this._getFirstWeekDay(),E=B.getDaysStandAlone("abbreviated",this.getPrimaryCalendarType()),F,i;this._bNamesLengthChecked=undefined;this._bLongWeekDays=undefined;for(i=0;i<W.length;i++){F=W[i];F.textContent=E[(i+S)%7];}A.call(this);};s.prototype._handleBorderReached=function(i){var E=i.getParameter("event");var B=0;var O=this._getDate();var F=new b(O,this.getPrimaryCalendarType());if(E.type){switch(E.type){case"sapnext":case"sapnextmodifiers":if(E.keyCode===K.ARROW_DOWN){F.setDate(F.getDate()+7);}else{F.setDate(F.getDate()+1);}break;case"sapprevious":case"sappreviousmodifiers":if(E.keyCode===K.ARROW_UP){F.setDate(F.getDate()-7);}else{F.setDate(F.getDate()-1);}break;case"sappagedown":B=F.getMonth()+1;F.setMonth(B);if(B%12!==F.getMonth()){while(B!==F.getMonth()){F.setDate(F.getDate()-1);}}break;case"sappageup":B=F.getMonth()-1;F.setMonth(B);if(B<0){B=11;}if(B!==F.getMonth()){while(B!==F.getMonth()){F.setDate(F.getDate()-1);}}break;default:break;}this.fireFocus({date:F.toLocalJSDate(),otherMonth:true});if(this._isMarkingUnfinishedRangeAllowed()){var G=this.getSelectedDates()[0],P=parseInt(this._oFormatYyyymmdd.format(G.getStartDate())),H=parseInt(this._oFormatYyyymmdd.format(F.toLocalJSDate()));this._markDatesBetweenStartAndHoveredDate(P,H);}}};s.prototype.checkDateFocusable=function(i){a._checkJSDateObject(i);var B=this._getDate();var E=b.fromLocalJSDate(i,this.getPrimaryCalendarType());return a._isSameMonthAndYear(E,B);};s.prototype.applyFocusInfo=function(i){this._oItemNavigation.focusItem(this._oItemNavigation.getFocusedIndex());return this;};s.prototype._renderHeader=function(){if(this._getShowHeader()){var i=this._getDate();var B=this._getLocaleData();var E=B.getMonthsStandAlone("wide",this.getPrimaryCalendarType());this.$("Head").text(E[i.getMonth()]);}};s.prototype._getFirstWeekDay=function(){return this._getFirstDayOfWeek();};s.prototype._isMonthNameLong=function(W){var i;var B;for(i=0;i<W.length;i++){B=W[i];if(Math.abs(B.clientWidth-B.scrollWidth)>1){return true;}}return false;};s.prototype._getVisibleDays=function(S,i){var N,B,E,F,G,H,Y;if(!S){return this._aVisibleDays;}this._aVisibleDays=[];H=this._getFirstDayOfWeek();G=new b(S,this.getPrimaryCalendarType());G.setDate(1);F=G.getDay()-H;if(F<0){F=7+F;}if(F>0){G.setDate(1-F);}B=new b(G);N=(S.getMonth()+1)%12;do{Y=B.getYear();E=new b(B,this.getPrimaryCalendarType());if(i&&Y<1){E._bBeforeFirstYear=true;this._aVisibleDays.push(E);}else if(Y>0&&Y<10000){this._aVisibleDays.push(E);}B.setDate(B.getDate()+1);}while(B.getMonth()!==N||B.getDay()!==H);return this._aVisibleDays;};s.prototype._handleMousedown=function(E,F){var W=E.target.classList.contains("sapUiCalWeekNum"),i=!E.button,S=this._getSelectedDateFromEvent(E);if(!i||D.support.touch){return this;}if(W){this._isWeekSelectionAllowed()&&this._handleWeekSelection(S,true);return this;}else if(E.shiftKey&&this._isConsecutiveDaysSelectionAllowed()){this._handleConsecutiveDaysSelection(S);return this;}var B=this._selectDay(F);if(B){this._bMousedownChange=true;}if(this._bMouseMove){this._unbindMousemove(true);this._bMoveChange=false;this._oMoveSelectedDate=undefined;}else if(B&&this.getIntervalSelection()&&this.$().is(":visible")){this._bindMousemove(true);this._oMoveSelectedDate=new b(F,this.getPrimaryCalendarType());}E.preventDefault();E.setMark("cancelAutoClose");};s.prototype._getSelectedDateFromEvent=function(E){var T=E.target,i,P;if(T.classList.contains("sapUiCalWeekNum")){i=T.nextSibling.getAttribute("data-sap-day");}else{i=T.getAttribute("data-sap-day")||T.parentNode.getAttribute("data-sap-day");}P=this._oFormatYyyymmdd.parse(i);return P?b.fromLocalJSDate(P,this.getPrimaryCalendarType()):null;};s.prototype._handleWeekSelection=function(S,F){var i=this._calculateWeekNumber(S),E=this._getLastWeekDate(S),B=this.getSingleSelection(),G=this.getIntervalSelection(),H=this._checkDateEnabled(S)?S:null,J=this._checkDateEnabled(E)?E:null;if(S.isAfter(this._oMaxDate)||E.isBefore(this._oMinDate)){return this;}if(!H){H=new b(this._oMinDate);}if(!J){J=new b(this._oMaxDate);}if(!B&&!G){this._handleWeekSelectionByMultipleDays(i,H,J);}else if(B&&G){this._handleWeekSelectionBySingleInterval(i,H,J);}F&&this._focusDate(H);return this;};s.prototype._handleConsecutiveDaysSelection=function(E){var S=this.getSelectedDates(),i=S.length&&S[S.length-1].getStartDate(),B=i?b.fromLocalJSDate(i):E,F;F=this._areAllDaysBetweenSelected(B,E);this._toggleDaysBetween(B,E,!F);return this;};s.prototype._calculateWeekNumber=function(i){var B=new g(this._getLocale());var E=this._getLastWeekDate(i);var W=n.getWeekConfigurationValues(this.getCalendarWeekNumbering(),B);var F;var G;F=e.getInstance({pattern:"w",calendarType:this.getPrimaryCalendarType(),calendarWeekNumbering:this.getCalendarWeekNumbering()},B);var H=W.firstDayOfWeek===0;if(E.getMonth()===0&&this._oDate.getMonth()===0&&H){G=F.format(E.toUTCJSDate(),true);}else{G=F.format(i.toUTCJSDate(),true);}return G;};s.prototype._isWeekSelectionAllowed=function(){var S=this.getSingleSelection(),i=this.getIntervalSelection(),B=this.getPrimaryCalendarType(),E=this.getFirstDayOfWeek()!==-1,F=!S&&!i,G=S&&i,H=G||F;return B===p.Gregorian&&!E&&H;};s.prototype._isConsecutiveDaysSelectionAllowed=function(){var S=this.getSingleSelection(),i=this.getIntervalSelection();return!S&&!i;};s.prototype._isMarkingUnfinishedRangeAllowed=function(){var S=this.getSelectedDates()[0],V=!!(S&&S.getStartDate()&&!S.getEndDate());return(this.getIntervalSelection()&&V);};s.prototype._handleWeekSelectionByMultipleDays=function(W,S,E){var i,B;if(this._areAllDaysBetweenSelected(S,E)){i=null;}else{i=new c({startDate:S.toLocalJSDate(),endDate:E.toLocalJSDate()});}B=this.fireWeekNumberSelect({weekNumber:W,weekDays:i});if(B){this._toggleDaysBetween(S,E,!!i);}return this;};s.prototype._handleWeekSelectionBySingleInterval=function(W,S,E){var i=new c({startDate:S.toLocalJSDate(),endDate:E.toLocalJSDate()}),B=this.getParent(),F=this,G;if(B&&B.getSelectedDates){F=B;}if(this._isIntervalSelected(i)){i=null;}G=this.fireWeekNumberSelect({weekNumber:W,weekDays:i});if(G){F.removeAllSelectedDates();F.addSelectedDate(i);}return this;};s.prototype._isIntervalSelected=function(i){var S=this.getSelectedDates(),B=S.length&&S[0],E=B&&B.getEndDate();return B&&B.getStartDate()&&B.getStartDate().getTime()===i.getStartDate().getTime()&&E&&B.getEndDate()&&B.getEndDate().getTime()===i.getEndDate().getTime();};s.prototype._getLastWeekDate=function(W){return new b(W).setDate(W.getDate()+6);};s.prototype._toggleDaysBetween=function(S,E,i){var B=this._arrangeStartAndEndDates(S,E),F=new b(B.startDate),G;do{G=this._checkDateSelected(F);if((!G&&i)||(G&&!i)){this._selectDay(F);z.call(this);}F.setDate(F.getDate()+1);}while(F.isSameOrBefore(B.endDate));return this;};s.prototype._areAllDaysBetweenSelected=function(S,E){var i=this._arrangeStartAndEndDates(S,E),B=new b(i.startDate),F=true;do{if(!this._checkDateSelected(B)){F=false;break;}B.setDate(B.getDate()+1);}while(B.isSameOrBefore(i.endDate));return F;};s.prototype._arrangeStartAndEndDates=function(S,E){var i=S.isSameOrBefore(E);return{startDate:i?S:E,endDate:i?E:S};};s.prototype._selectDay=function(B,E){if(!this._checkDateEnabled(B)){return false;}var S=this.getSelectedDates();var F;var G=this._oItemNavigation.getItemDomRefs();var $;var Y;var i=0;var P=this.getParent();var H=this;var J;var N=this.getPrimaryCalendarType();if(P&&P.getSelectedDates){H=P;}if(this.getSingleSelection()){if(S.length>0){F=S[0];J=F.getStartDate();if(J){J=b.fromLocalJSDate(J,N);}}else{F=new c();H.addAggregation("selectedDates",F,true);}if(this.getIntervalSelection()&&(!F.getEndDate()||E)&&J){var O;if(B.isBefore(J)){O=J;J=B;if(!E){F.setProperty("startDate",J.toLocalJSDate(),true);F.setProperty("endDate",O.toLocalJSDate(),true);}}else if(B.isSameOrAfter(J)){O=B;if(!E){F.setProperty("endDate",O.toLocalJSDate(),true);}}x.call(this,J,O);}else{x.call(this,B);F.setProperty("startDate",B.toLocalJSDate(),true);F.setProperty("endDate",undefined,true);}}else{if(this.getIntervalSelection()){throw new Error("Calender don't support multiple interval selection");}else{var Q=this._checkDateSelected(B);if(Q>0){for(i=0;i<S.length;i++){J=S[i].getStartDate();if(J&&B.isSame(b.fromLocalJSDate(J,N))){H.removeAggregation("selectedDates",i,true);break;}}}else{F=new c({startDate:B.toLocalJSDate()});H.addAggregation("selectedDates",F,true);}Y=this._oFormatYyyymmdd.format(B.toUTCJSDate(),true);for(i=0;i<G.length;i++){$=q(G[i]);if($.attr("data-sap-day")===Y){if(Q>0){$.removeClass("sapUiCalItemSel");$.attr("aria-selected","false");}else{$.addClass("sapUiCalItemSel");$.attr("aria-selected","true");}}}}}return true;};s.prototype._getSpecialDates=function(){var P=this.getParent();if(P&&P._getSpecialDates){return P._getSpecialDates();}else{var B=this.getSpecialDates();for(var i=0;i<B.length;i++){var N=B[i].getSecondaryType()===l.CalendarDayType.NonWorking&&B[i].getType()!==l.CalendarDayType.NonWorking;if(N){var E=new d();E.setType(l.CalendarDayType.NonWorking);E.setStartDate(B[i].getStartDate());if(B[i].getEndDate()){E.setEndDate(B[i].getEndDate());}B.push(E);}}return B;}};function _(){var Y=this._oFormatYyyymmdd.format(this._getDate().toUTCJSDate(),true),B=0,R=this.getDomRef(),E=R.querySelectorAll(".sapUiCalItem");for(var i=0;i<E.length;i++){if(E[i].getAttribute("data-sap-day")===Y){B=i;break;}}if(!this._oItemNavigation){this._oItemNavigation=new I();this._oItemNavigation.attachEvent(I.Events.AfterFocus,t,this);this._oItemNavigation.attachEvent(I.Events.FocusAgain,u,this);this._oItemNavigation.attachEvent(I.Events.BorderReached,this._handleBorderReached,this);this.addDelegate(this._oItemNavigation);if(this._iColumns>1){this._oItemNavigation.setHomeEndColumnMode(true,true);}this._oItemNavigation.setDisabledModifiers({sapnext:["alt"],sapprevious:["alt"],saphome:["alt"],sapend:["alt"]});this._oItemNavigation.setCycling(false);this._oItemNavigation.setColumns(this._iColumns,true);}this._oItemNavigation.setRootDomRef(R);this._oItemNavigation.setItemDomRefs(E);this._oItemNavigation.setFocusedIndex(B);this._oItemNavigation.setPageSize(E.length);}function t(B){var E=B.getParameter("index");var F=B.getParameter("event");if(!F){return;}var O=this._getDate();var G=new b(O,this.getPrimaryCalendarType());var H=false;var J=true;var N=this._oItemNavigation.getItemDomRefs();var i=0;var $=q(N[E]);var P;if($.hasClass("sapUiCalItemOtherMonth")){if(F.type==="saphomemodifiers"&&(F.metaKey||F.ctrlKey)){G.setDate(1);this._focusDate(G);}else if(F.type==="sapendmodifiers"&&(F.metaKey||F.ctrlKey)){for(i=N.length-1;i>0;i--){P=q(N[i]);if(!P.hasClass("sapUiCalItemOtherMonth")){G=b.fromLocalJSDate(this._oFormatYyyymmdd.parse(P.attr("data-sap-day")),this.getPrimaryCalendarType());break;}}this._focusDate(G);}else{H=true;G=b.fromLocalJSDate(this._oFormatYyyymmdd.parse($.attr("data-sap-day")),this.getPrimaryCalendarType());if(!G){G=new b(O);}this._focusDate(O);if(F.type==="mousedown"||(this._sTouchstartYyyyMMdd&&F.type==="focusin"&&this._sTouchstartYyyyMMdd===$.attr("data-sap-day"))){J=false;this.fireFocus({date:O.toLocalJSDate(),otherMonth:false,restoreOldDate:true});}if(F.originalEvent&&F.originalEvent.type==="touchstart"){this._sTouchstartYyyyMMdd=$.attr("data-sap-day");}else{this._sTouchstartYyyyMMdd=undefined;}}}else{if(q(F.target).hasClass("sapUiCalWeekNum")){this._focusDate(G);}else{G=b.fromLocalJSDate(this._oFormatYyyymmdd.parse($.attr("data-sap-day")),this.getPrimaryCalendarType());this._setDate(G);}this._sTouchstartYyyyMMdd=undefined;}if(F.type==="mousedown"&&this.getIntervalSelection()){this._sLastTargetId=$.attr("id");}if(J){this.fireFocus({date:G.toLocalJSDate(),otherMonth:H});}if(F.type==="mousedown"){this._handleMousedown(F,G,E);}if(F.type==="sapnext"||F.type==="sapprevious"){var S=this.getSelectedDates()[0],Q,R;if(!this._isMarkingUnfinishedRangeAllowed()){return;}Q=parseInt(this._oFormatYyyymmdd.format(S.getStartDate()));R=$.data("sapDay");this._markDatesBetweenStartAndHoveredDate(Q,R);}}function u(i){var B=i.getParameter("index");var E=i.getParameter("event");if(!E){return;}if(E.type==="mousedown"){var F=this._getDate();if(this.getIntervalSelection()){var G=this._oItemNavigation.getItemDomRefs();this._sLastTargetId=G[B].id;}this._handleMousedown(E,F,B);}}function v(i,N){a._checkCalendarDate(i);var Y=i.getYear();a._checkYearInValidRange(Y);var F=true;if(!this.getDate()||!i.isSame(b.fromLocalJSDate(this.getDate(),i.getCalendarType()))){var B=new b(i);F=this.checkDateFocusable(i.toLocalJSDate());this.setProperty("date",i.toLocalJSDate(),true);this._oDate=B;}if(this.getDomRef()){if(F){this._focusDate(this._oDate,true,N);}else{w.call(this,N);}}}s.prototype._focusDate=function(B,S,E){if(!S){this.setDate(B.toLocalJSDate());}var Y=this._oFormatYyyymmdd.format(B.toUTCJSDate(),true);var F=this._oItemNavigation.getItemDomRefs();var $;for(var i=0;i<F.length;i++){$=q(F[i]);if($.attr("data-sap-day")===Y){if(document.activeElement!==F[i]){if(E){this._oItemNavigation.setFocusedIndex(i);}else{this._oItemNavigation.focusItem(i);}}break;}}};function w(N){var B=this.getRenderer().getStartDate(this),E=this.getDomRef(),W=this.getDomRef().querySelector(".sapUiCalRowWeekNumbers"),F,i=0,G=0;if(this._sLastTargetId){F=this._oItemNavigation.getItemDomRefs();for(i=0;i<F.length;i++){if(F[i].id===this._sLastTargetId){G=i;break;}}}if(E){var R=sap.ui.getCore().createRenderManager();this.getRenderer().renderMonth(R,this,B);R.flush(E);if(W){this.getRenderer().renderWeekNumbers(R,this);R.flush(W);}R.destroy();}this._renderHeader();this.fireEvent("_renderMonth",{days:E.querySelectorAll(".sapUiCalItem").length});_.call(this);if(!N){this._oItemNavigation.focusItem(this._oItemNavigation.getFocusedIndex());}if(this._sLastTargetId){F=this._oItemNavigation.getItemDomRefs();if(G<=F.length-1){this._sLastTargetId=F[G].id;}}}function x(S,E){if(!Array.isArray(S)){S=[S];}var B=this.getDomRef()?this.getDomRef().querySelectorAll(".sapUiCalItem:not(.sapUiCalDummy)"):[];var $;var i=0;var F=false;var G=false;if(!E){var H=S.map(function(N){return this._oFormatYyyymmdd.format(N.toUTCJSDate(),true);},this);for(i=0;i<B.length;i++){$=q(B[i]);F=false;G=false;if(H.indexOf($.attr("data-sap-day"))>-1){$.addClass("sapUiCalItemSel");$.attr("aria-selected","true");F=true;}else if($.hasClass("sapUiCalItemSel")){$.removeClass("sapUiCalItemSel");$.attr("aria-selected","false");}if($.hasClass("sapUiCalItemSelStart")){$.removeClass("sapUiCalItemSelStart");}else if($.hasClass("sapUiCalItemSelBetween")){$.removeClass("sapUiCalItemSelBetween");}else if($.hasClass("sapUiCalItemSelEnd")){$.removeClass("sapUiCalItemSelEnd");}y.call(this,$,F,G);}}else{var J;for(i=0;i<B.length;i++){$=q(B[i]);F=false;G=false;J=b.fromLocalJSDate(this._oFormatYyyymmdd.parse($.attr("data-sap-day")),p.Gregorian);if(J.isSame(S[0])){$.addClass("sapUiCalItemSelStart");F=true;$.addClass("sapUiCalItemSel");$.attr("aria-selected","true");if(E&&J.isSame(E)){$.addClass("sapUiCalItemSelEnd");G=true;}$.removeClass("sapUiCalItemSelBetween");}else if(E&&a._isBetween(J,S[0],E)){$.addClass("sapUiCalItemSel");$.attr("aria-selected","true");$.addClass("sapUiCalItemSelBetween");$.removeClass("sapUiCalItemSelStart");$.removeClass("sapUiCalItemSelEnd");}else if(E&&J.isSame(E)){$.addClass("sapUiCalItemSelEnd");G=true;$.addClass("sapUiCalItemSel");$.attr("aria-selected","true");$.removeClass("sapUiCalItemSelStart");$.removeClass("sapUiCalItemSelBetween");}else{if($.hasClass("sapUiCalItemSel")){$.removeClass("sapUiCalItemSel");$.attr("aria-selected","false");}if($.hasClass("sapUiCalItemSelStart")){$.removeClass("sapUiCalItemSelStart");}else if($.hasClass("sapUiCalItemSelBetween")){$.removeClass("sapUiCalItemSelBetween");}else if($.hasClass("sapUiCalItemSelEnd")){$.removeClass("sapUiCalItemSelEnd");}}y.call(this,$,F,G);}}}function y($,S,E){if(!this.getIntervalSelection()){return;}var B="";var F=[];var G=this.getId();var H=false;B=$.attr("aria-describedby");if(B){F=B.split(" ");}var J=-1;var N=-1;for(var i=0;i<F.length;i++){var O=F[i];if(O===(G+"-Start")){J=i;}if(O===(G+"-End")){N=i;}}if(J>=0&&!S){F.splice(J,1);H=true;if(N>J){N--;}}if(N>=0&&!E){F.splice(N,1);H=true;}if(J<0&&S){F.push(G+"-Start");H=true;}if(N<0&&E){F.push(G+"-End");H=true;}if(H){B=F.join(" ");$.attr("aria-describedby",B);}}function z(){if(this._bMouseMove){this._unbindMousemove(true);}this.fireSelect();}function A(){if(!this._bNamesLengthChecked){var W,B=this.getDomRef().querySelectorAll(".sapUiCalWH:not(.sapUiCalDummy)"),T=this._isMonthNameLong(B),E,S,F,i;if(T){this._bLongWeekDays=false;E=this._getLocaleData();S=this._getFirstWeekDay();F=E.getDaysStandAlone("narrow",this.getPrimaryCalendarType());for(i=0;i<B.length;i++){W=B[i];W.textContent=F[(i+S)%7];}}else{this._bLongWeekDays=true;}this._bNamesLengthChecked=true;}}return s;});
