/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/Object","../thirdparty/three","../HighlightDisplayState"],function(B,t,H){"use strict";var a=B.extend("sap.ui.vk.threejs.HighlightPlayer",{constructor:function(){this._state=H.stopped;this._startTime=0;this._timeElapsed=0;this._highlightsNodesMap=new Map();}});a.prototype.reset=function(v,s){this.stop();this._highlightsNodesMap.clear();this._state=H.stopped;if(v&&s){var h=v.getHighlightIdNodesMap();var b=this;h.forEach(function(c,k){var d=s.getHighlight(k);b.addHighlights(d,c);});}return this;};a.prototype.setViewStateManager=function(v){this._viewStateManager=v;};a.prototype.addHighlights=function(h,n){if(h&&n&&n.length){this._highlightsNodesMap.set(h,n);}};a.prototype.start=function(b){if(this._state===H.pausing){this._startTime=b-this._timeElapsed;}else{this._startTime=b;this._timeElapsed=0;}this._state=H.playing;var v=this._viewStateManager;this._highlightsNodesMap.forEach(function(n,h){v.setVisibilityState(n,true,false);});};a.prototype.play=function(b){if(this._state!==H.playing){return false;}this._timeElapsed=b-this._startTime;var c=this;var d=[];this._highlightsNodesMap.forEach(function(n,h){var r=h.getColour(c._timeElapsed/1000.0);var e;if(r!==undefined){for(e=0;e<n.length;e++){n[e]._vkSetHighlightColor(r.colour);}}var f=h.getOpacity(c._timeElapsed/1000.0);if(f!==undefined){for(e=0;e<n.length;e++){n[e]._vkSetOpacity(f.opacity);}if(f.isCompleted&&h.isFadeOut()){c._viewStateManager.setVisibilityState(n,false,false);}}if((r===undefined||r.isCompleted)&&(f===undefined||f.isCompleted)){d.push(h);}});d.forEach(function(h){c._highlightsNodesMap.delete(h);});if(this._highlightsNodesMap.size===0){this._state=H.stopped;return false;}return true;};a.prototype.stop=function(b){this._timeElapsed=0;this._startTime=0;var c=this;this._highlightsNodesMap.forEach(function(n,h){for(var d=0;d<n.length;d++){var e=n[d];e._vkSetHighlightColor(undefined);e._vkSetOpacity(undefined);}if(h.isFadeOut()){c._viewStateManager.setVisibilityState(n,false,false);}});this._state=H.stopped;return this;};a.prototype.pause=function(b){if(this._state===H.stopped){return this;}this._timeElapsed=b-this._startTime;this._state=H.pausing;return this;};return a;});
