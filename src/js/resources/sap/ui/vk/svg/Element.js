/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","../abgrToColor","../NodeContentType"],function(q,d,N){"use strict";var E=function(p){p=p||{};this.type="Group";this.uid=q.sap.uid();this.sid=p.sid||undefined;this.name=p.name||undefined;this.vMask=p.subelement?undefined:(1|0);this.sMask=(0|0);this.matrix=new Float32Array(p.matrix||[1,0,0,1,0,0]);this.parent=null;this.children=[];this.domRef=null;this.nodeContentType=N.Regular;this.materialId=p.materialID;this.userData=p.subelement?{skipIt:true}:{};};function e(c,a){if(c){if(c.length===4){return new Float32Array(c);}else{return new Float32Array([c[0],c[1],c[2],a]);}}return new Float32Array([0,0,0,a]);}E.prototype.isFillable=function(){return true;};E.prototype.setMaterial=function(m,a){m=m||{};if(this.materialId===m.materialId){this.fill=e(this.isFillable()?m.color:undefined,0);this.stroke=e(m.lineColor,1);this.strokeWidth=m.lineWidth!==undefined?m.lineWidth:1;this.strokeDashArray=(m.lineStyle&&m.lineStyle.dashPattern)||[];if(m.lineStyle&&m.lineStyle.widthCoordinateSpace!==undefined){this.widthCoordinateSpace=m.lineStyle.widthCoordinateSpace;}}for(var i=0,l=this.children.length;i<l;i++){this.children[i].setMaterial(m);}if(a){this.invalidate();}};E.prototype.add=function(a){if(a.parent!==null){a.parent.remove(a);}a.parent=this;this.children.push(a);a.sMask=this.sMask;if(this.highlightColor){a.highlightColor=this.highlightColor;}return this;};E.prototype.remove=function(a){var i=this.children.indexOf(a);if(i!==-1){a.parent=null;this.children.splice(i,1);}return this;};E.prototype.replace=function(a,n){var i=this.children.indexOf(a);if(i!==-1){a.parent=null;n.parent=this;this.children[i]=n;n.domRef=a.domRef;n.invalidate();}return this;};E.prototype._vkPersistentId=function(){var o=this;do{if(o.sid){return o.sid;}o=o.parent;}while(o);return null;};E.prototype._vkGetNodeContentType=function(){return this.nodeContentType;};E.prototype._vkSetNodeContentType=function(n){this.nodeContentType=n;};E.prototype.traverse=function(c){c(this);var a=this.children;for(var i=0,l=a.length;i<l;i++){a[i].traverse(c);}};E.prototype.traverseAncestors=function(c){var p=this.parent;if(p!==null){c(p);p.traverseAncestors(c);}};E.prototype.traverseVisible=function(c,m){if(this.isVisible(m)){c(this);var a=this.children;for(var i=0,l=a.length;i<l;i++){a[i].traverseVisible(c,m);}}};E.prototype.setVisible=function(m,v){if(this.vMask!==undefined){if(v){this.vMask|=m;}else{this.vMask&=~m;}if(this.domRef!==null){this.domRef.setAttribute("visibility",v?"visible":"hidden");}}};E.prototype.isVisible=function(m){return this.vMask!==undefined?(this.vMask&m)!==0:true;};E.prototype._updateColor=function(m){if(this.domRef!==null){if(this.fill!==undefined){this.domRef.setAttribute("fill",this._cssColor(this.fill,m));}if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth>0){this.domRef.setAttribute("stroke",this._cssColor(this.stroke,m));}}};E.prototype.setSelected=function(m,a,b){if(a){this.sMask|=m;this.highlightColor=b;}else{this.sMask&=~m;delete this.highlightColor;}this._updateColor(m);};E.prototype.isSelected=function(m){return(this.sMask&m)!==0;};E.prototype.setTintColor=function(m,t){this.tintColor=t;this._updateColor(m);};E.prototype.setOpacity=function(m,o){this.opacity=o;if(this.domRef!==null){this.domRef.setAttribute("opacity",o!==undefined?o:1);}};E.prototype.setMatrix=function(m){this.matrix=m;if(this.domRef!==null){this.domRef.setAttribute("transform","matrix("+this.matrix.join(",")+")");}};E._multiplyMatrices=function(a,b){var c=a[0],f=a[2],g=a[4];var i=a[1],l=a[3],m=a[5];var n=b[0],o=b[2],p=b[4];var r=b[1],t=b[3],u=b[5];return new Float32Array([c*n+f*r,i*n+l*r,c*o+f*t,i*o+l*t,c*p+f*u+g,i*p+l*u+m]);};E.prototype._matrixWorld=function(m){if(m!==undefined){return E._multiplyMatrices(m,this.matrix);}else{var p=this.parent;var a=this.matrix;while(p!==null){a=E._multiplyMatrices(p.matrix,a);p=p.parent;}return a;}};function h(b,x,y,a,c){b.min.x=Math.min(b.min.x,x-a);b.min.y=Math.min(b.min.y,y-c);b.max.x=Math.max(b.max.x,x+a);b.max.y=Math.max(b.max.y,y+c);}function s(a){return a*a;}E.prototype._expandBoundingBoxCE=function(b,m,c,a,f,g){h(b,c*m[0]+a*m[2]+m[4],c*m[1]+a*m[3]+m[5],Math.abs(f*m[0])+Math.abs(g*m[2]),Math.abs(f*m[1])+Math.abs(g*m[3]));};E.prototype._expandBoundingBoxCR=function(b,m,c,a,r,f){h(b,c*m[0]+a*m[2]+m[4],c*m[1]+a*m[3]+m[5],Math.sqrt(s(r*m[0])+s(f*m[2])),Math.sqrt(s(r*m[1])+s(f*m[3])));};E.prototype._expandBoundingBox=function(b,m){};E.prototype._expandBoundingBoxRecursive=function(b,m,a){if(this.isVisible(m)){var c=this._matrixWorld(a);this._expandBoundingBox(b,c);var f=this.children;for(var i=0,l=f.length;i<l;i++){f[i]._expandBoundingBoxRecursive(b,m,c);}}};E.prototype._getSceneTreeElement=function(){var a=this;var p=a.parent;while(p){if(p.userData.closed){a=p;}p=p.parent;}while(a.userData.skipIt){a=a.parent;}return a;};E.prototype._findRectElementsRecursive=function(a,r,m,b){if(this.isVisible(m)){var c=this._matrixWorld(b);var f=this.children;var g={min:{x:Infinity,y:Infinity},max:{x:-Infinity,y:-Infinity}};this._expandBoundingBox(g,c);if(g.min.x<=r.x2&&g.max.x>=r.x1&&g.min.y<=r.y2&&g.max.y>=r.y1){a.add(this._getSceneTreeElement());}for(var i=0,l=f.length;i<l;i++){f[i]._findRectElementsRecursive(a,r,m,c);}}};E.prototype.tagName=function(){return"g";};E.prototype._setBaseAttributes=function(a,m){a("id",this.uid);a("opacity",this.opacity!==undefined?this.opacity:1);a("transform","matrix("+this.matrix.join(",")+")");if(this.vMask!==undefined){a("visibility",this.isVisible(m)?"visible":"hidden");}if(this.fill!==undefined){a("fill",this._cssColor(this.fill,m));}if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth>0){a("stroke",this._cssColor(this.stroke,m));a("stroke-width",this.strokeWidth);a("vector-effect","non-scaling-stroke");if(this.strokeDashArray.length>0){a("stroke-dasharray",this.strokeDashArray.join(" "));}}};E.prototype._setSpecificAttributes=function(a){};E.prototype.render=function(r,m){var t=this.tagName();r.write("<"+t);var a=r.writeAttribute.bind(r);this._setBaseAttributes(a,m);this._setSpecificAttributes(a);r.write(">");if(this._getTextContent){r.write(this._getTextContent());}this.children.forEach(function(b){b.render(r,m);});r.write("</"+t+">");};E.prototype._createDomElement=function(c){var a=document.createElementNS("http://www.w3.org/2000/svg",this.tagName());var b=a.setAttribute.bind(a);this._setBaseAttributes(b,1<<c);this._setSpecificAttributes(b);if(this._getTextContent){a.textContent=this._getTextContent();}return a;};E.prototype.invalidate=function(c){if(this.domRef!==null){var o=this.domRef;this.domRef=this._createDomElement(c);o.parentNode.replaceChild(this.domRef,o);while(o.children.length>0){this.domRef.appendChild(o.children[0]);}}};E.prototype.rerender=function(c){var o=this.domRef;if(o!==null&&o.parentNode!==null){this.traverse(function(n){n.domRef=n._createDomElement(c);if(n===this){o.parentNode.replaceChild(n.domRef,o);}else{n.parent.domRef.appendChild(n.domRef);}}.bind(this));}};function j(a,b){var c=a.children;for(var i=0,l=c.length;i<l;i++){if(c[i].id===b){return c[i];}}return null;}E.prototype._setDomRef=function(a){this.domRef=a;var c=this.children;for(var i=0,l=c.length;i<l;i++){var b=c[i];b._setDomRef(a?j(a,b.uid):null);}};E.prototype.getElementByProperty=function(n,v){if(this[n]===v){return this;}var c=this.children;for(var i=0,l=c.length;i<l;i++){var a=c[i].getElementByProperty(n,v);if(a!==null){return a;}}return null;};E.prototype.getElementById=function(i){return this.getElementByProperty("uid",i);};function k(a,b,f){return a+(b-a)*f;}E.prototype._cssColor=function(c,m){var a=c[3];if(a===0){return"none";}var r=c[0]*255;var g=c[1]*255;var b=c[2]*255;var t=this.tintColor;if(t){t=d(t);var f=t.alpha;if(f>0){r=k(r,t.red,f);g=k(g,t.green,f);b=k(b,t.blue,f);}}var i=this.highlightColor;if(i){i=d(i);var l=i.alpha;if(l>0){r=k(r,i.red,l);g=k(g,i.green,l);b=k(b,i.blue,l);a=k(a,l,l);}}var n=((r<<24)|(g<<16)|(b<<8)|(a*255))>>>0;return"#"+("00000000"+n.toString(16)).slice(-8);};return E;});
